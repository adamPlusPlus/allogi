import{useState as c,useEffect as p,useCallback as h}from"react";function I(){let[l,d]=c([]),[v,m]=c(new Map);p(()=>{let e=()=>{try{let a=localStorage.getItem("allog-save-system");if(a){let o=(JSON.parse(a).items?.filter(r=>r.type?.startsWith("highlight-")&&r.metadata?.highlightData)||[]).map(r=>({id:r.id,name:r.name,scriptId:r.metadata.highlightData.scriptId,moduleId:r.metadata.highlightData.moduleId,methodId:r.metadata.highlightData.methodId,valueId:r.metadata.highlightData.valueId,color:r.metadata.highlightData.color||"#ffff00",pattern:r.metadata.highlightData.pattern||"default",target:r.metadata.target||r.name||""}));d(o)}}catch{}};e();let i=a=>{a.key==="allog-save-system"&&e()};window.addEventListener("storage",i);let s=()=>{e()};return window.addEventListener("highlight-updated",s),()=>{window.removeEventListener("storage",i),window.removeEventListener("highlight-updated",s)}},[]);let g=h((e,i,s,a,n)=>l.find(t=>{if(t.scriptId&&i&&!i.includes(t.scriptId)||t.moduleId&&s&&!s.includes(t.moduleId)||t.valueId&&a&&!a.includes(t.valueId))return!1;if(e==="log"&&t.target&&n)return n.toLowerCase().includes(t.target.toLowerCase());if(a&&t.target)return a.toLowerCase().includes(t.target.toLowerCase());if(t.target){if(e==="log"&&n)return n.toLowerCase().includes(t.target.toLowerCase());if(a)return a.toLowerCase().includes(t.target.toLowerCase())}return!1})||null,[l]),u=h((e,i,s,a,n)=>{let t=g(e,i,s,a,n);if(!t)return{className:"",style:{},isHighlighted:!1};let o=`highlight-pattern-${t.pattern}`;return{className:`${e==="log"?"log-entry":e==="variable"||e==="state"||e==="function"||e==="property"||e==="event"?"monitoring-data-item":""} highlighted ${o}`,style:{"--highlight-color":t.color},isHighlighted:!0,highlight:t,dataAttributes:{"data-highlight-name":t.name}}},[g]),f=h(e=>{d(e)},[]);return{highlights:l,getHighlightForElement:g,getHighlightStyles:u,updateHighlights:f,isElementHighlighted:g}}export{I as useHighlights};
