import{useState as d,useEffect as z}from"react";import{Fragment as N,jsx as e,jsxs as a}from"react/jsx-runtime";var B=({isOpen:v,onClose:y})=>{let[R,T]=d([{id:"allog-server",name:"Allog Intermediary Server",type:"server",saveLogsDir:"./logs/allog-server",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"formwise-app",name:"FormWise Application",type:"client",saveLogsDir:"./logs/formwise",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"lib-interactive",name:"Interactive Library",type:"library",saveLogsDir:"./logs/lib/interactive",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"features-formhub",name:"FormHub Feature",type:"feature",saveLogsDir:"./logs/features/formhub",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"features-clausesight",name:"ClauseSight Feature",type:"feature",saveLogsDir:"./logs/features/clausesight",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()}]),[n,j]=d(null),[x,A]=d(!0),[k,F]=d(5e3),[i,h]=d("recipients"),[p,O]=d(null),[r,$]=d(null),[l,D]=d(null),[g,w]=d(!1),[S,L]=d(null);z(()=>{if(v&&x){let t=setInterval(()=>{T(s=>s.map(o=>({...o,logCount:Math.floor(Math.random()*1e3)+o.logCount,lastLogTime:new Date().toISOString()})))},k);return()=>clearInterval(t)}},[v,x,k]),z(()=>{v&&C()},[v,i]);let C=async()=>{try{let t=[];(i==="database"||i==="maintenance")&&t.push(fetch("/api/database/config").then(o=>o.ok?o.json():null),fetch("/api/database/stats").then(o=>o.ok?o.json():null)),(i==="archives"||i==="maintenance")&&t.push(fetch("/api/archives").then(o=>o.ok?o.json():null));let s=await Promise.all(t);i==="database"||i==="maintenance"?(O(s[0]),$(s[1]),(i==="archives"||i==="maintenance")&&D(s[2])):i==="archives"&&D(s[0])}catch(t){console.error("Failed to load data management info:",t),c("Failed to load data management information","error")}},c=(t,s)=>{L({message:t,type:s}),setTimeout(()=>L(null),5e3)},M=async()=>{try{w(!0);let t=await fetch("/api/archives/rotate",{method:"POST"}),s=await t.json();t.ok?(c("Log rotation completed successfully","success"),await C()):c(s.error||"Failed to trigger log rotation","error")}catch{c("Failed to trigger log rotation","error")}finally{w(!1)}},E=async t=>{try{let s=await fetch(`/api/archives/${t}`);if(s.ok){let o=await s.blob(),u=window.URL.createObjectURL(o),m=document.createElement("a");m.href=u,m.download=t,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(u),c(`Archive ${t} downloaded successfully`,"success")}else c("Failed to download archive","error")}catch{c("Failed to download archive","error")}},b=async(t,s="json")=>{try{w(!0);let o="";switch(t){case"logs":o=`/api/export/logs?format=${s}`;break;case"monitoring":o=`/api/export/monitoring?format=${s}`;break;case"backup":o=`/api/export/backup?format=${s}`;break}let u=await fetch(o);if(u.ok){let m=await u.blob(),I=window.URL.createObjectURL(m),f=document.createElement("a");f.href=I,f.download=`allog-${t}-export-${new Date().toISOString().slice(0,19).replace(/[-:]/g,"")}.${s}`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(I),c(`${t} data exported successfully`,"success")}else c(`Failed to export ${t} data`,"error")}catch{c(`Failed to export ${t} data`,"error")}finally{w(!1)}},P=t=>{switch(t){case"active":return"\u{1F7E2}";case"inactive":return"\u26AA";case"error":return"\u{1F534}";default:return"\u2753"}},U=t=>{switch(t){case"server":return"\u{1F5A5}\uFE0F";case"client":return"\u{1F4F1}";case"feature":return"\u2728";case"library":return"\u{1F4DA}";default:return"\u2753"}},Y=async t=>{if(t.saveLogsDir)try{if("showDirectoryPicker"in window){let s=await window.showDirectoryPicker();console.log(`Opened directory for ${t.name}:`,s)}else alert(`Save logs directory: ${t.saveLogsDir}`)}catch(s){console.error("Failed to open directory:",s),alert(`Save logs directory: ${t.saveLogsDir}`)}};return v?e("div",{className:"settings-overlay",onClick:y,children:a("div",{className:"settings-modal",onClick:t=>t.stopPropagation(),children:[a("div",{className:"settings-header",children:[e("h2",{children:"\u2699\uFE0F Allog Settings"}),e("button",{className:"close-btn",onClick:y,children:"\xD7"})]}),S&&a("div",{className:`settings-notification ${S.type}`,children:[e("span",{children:S.message}),e("button",{onClick:()=>L(null),children:"\xD7"})]}),a("div",{className:"settings-tabs",children:[e("button",{className:`tab-btn ${i==="recipients"?"active":""}`,onClick:()=>h("recipients"),children:"\u{1F4CA} Recipients"}),e("button",{className:`tab-btn ${i==="database"?"active":""}`,onClick:()=>h("database"),children:"\u{1F5C4}\uFE0F Database"}),e("button",{className:`tab-btn ${i==="archives"?"active":""}`,onClick:()=>h("archives"),children:"\u{1F4C1} Archives"}),e("button",{className:`tab-btn ${i==="maintenance"?"active":""}`,onClick:()=>h("maintenance"),children:"\u{1F527} Maintenance"})]}),a("div",{className:"settings-content",children:[i==="recipients"&&e(N,{children:a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F4CA} Recipients & Save Logs Directories"}),e("p",{children:"View and manage save logs directories for each recipient sending data to Allog."}),e("div",{className:"recipients-grid",children:R.map(t=>a("div",{className:`recipient-card ${n?.id===t.id?"selected":""}`,onClick:()=>j(t),children:[a("div",{className:"recipient-header",children:[e("span",{className:"type-icon",children:U(t.type)}),e("span",{className:"status-icon",children:P(t.status)}),e("h4",{children:t.name})]}),a("div",{className:"recipient-details",children:[a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Type:"}),e("span",{className:"value",children:t.type})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Status:"}),e("span",{className:"value",children:t.status})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Log Count:"}),e("span",{className:"value",children:t.logCount.toLocaleString()})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Last Seen:"}),e("span",{className:"value",children:new Date(t.lastSeen||"").toLocaleString()})]}),t.lastLogTime&&a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Last Log:"}),e("span",{className:"value",children:new Date(t.lastLogTime).toLocaleString()})]})]}),t.saveLogsDir&&a("div",{className:"save-logs-section",children:[a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Save Logs Dir:"}),e("span",{className:"value path",children:t.saveLogsDir})]}),e("button",{className:"open-dir-btn",onClick:s=>{s.stopPropagation(),Y(t)},children:"\u{1F4C1} Open Directory"})]})]},t.id))})]})}),i==="database"&&a(N,{children:[a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F5C4}\uFE0F Database Configuration"}),p?e("div",{className:"database-info",children:a("div",{className:"info-grid",children:[a("div",{className:"info-item",children:[e("span",{className:"label",children:"Backend Type:"}),a("span",{className:`value db-type-${p.type}`,children:[p.type.toUpperCase(),p.connected?" \u{1F7E2}":" \u{1F534}"]})]}),a("div",{className:"info-item",children:[e("span",{className:"label",children:"Status:"}),e("span",{className:"value",children:p.connected?"Connected":"Disconnected"})]}),a("div",{className:"info-item",children:[e("span",{className:"label",children:"Indexed Queries:"}),e("span",{className:"value",children:p.capabilities.indexedQueries?"\u2705":"\u274C"})]}),a("div",{className:"info-item",children:[e("span",{className:"label",children:"Transactions:"}),e("span",{className:"value",children:p.capabilities.transactions?"\u2705":"\u274C"})]}),a("div",{className:"info-item",children:[e("span",{className:"label",children:"Advanced Filtering:"}),e("span",{className:"value",children:p.capabilities.advancedFiltering?"\u2705":"\u274C"})]})]})}):e("div",{className:"loading",children:"Loading database configuration..."})]}),r&&a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F4CA} Database Statistics"}),a("div",{className:"stats-grid",children:[a("div",{className:"stat-card",children:[e("div",{className:"stat-value",children:r.logs.toLocaleString()}),e("div",{className:"stat-label",children:"Total Logs"})]}),a("div",{className:"stat-card",children:[e("div",{className:"stat-value",children:r.monitoring.toLocaleString()}),e("div",{className:"stat-label",children:"Monitoring Entries"})]}),a("div",{className:"stat-card",children:[e("div",{className:"stat-value",children:r.sources.toLocaleString()}),e("div",{className:"stat-label",children:"Data Sources"})]}),a("div",{className:"stat-card",children:[e("div",{className:"stat-value",children:r.memoryIndexes.logIndexSize.toLocaleString()}),e("div",{className:"stat-label",children:"Log Index Size"})]})]})]})]}),i==="archives"&&a(N,{children:[a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F4C1} Archive Management"}),a("div",{className:"archive-controls",children:[e("button",{className:"action-btn primary",onClick:M,disabled:g,children:g?"\u23F3 Rotating...":"\u{1F504} Trigger Log Rotation"}),e("p",{className:"help-text",children:"Manually trigger log rotation to archive current logs and start fresh."})]})]}),l&&a("div",{className:"settings-section",children:[a("h3",{children:["\u{1F4E6} Archive Files (",l.totalArchives,")"]}),a("div",{className:"archive-summary",children:[a("div",{className:"summary-item",children:[e("span",{className:"label",children:"Archive Directory:"}),e("span",{className:"value",children:l.archiveDirectory})]}),a("div",{className:"summary-item",children:[e("span",{className:"label",children:"Total Size:"}),a("span",{className:"value",children:[(l.totalSize/1024/1024).toFixed(2)," MB"]})]})]}),l.archives.length>0?e("div",{className:"archives-list",children:l.archives.map(t=>a("div",{className:"archive-item",children:[a("div",{className:"archive-info",children:[e("div",{className:"archive-name",children:t.filename}),a("div",{className:"archive-details",children:[e("span",{children:t.sizeFormatted}),e("span",{children:new Date(t.created).toLocaleString()})]})]}),e("div",{className:"archive-actions",children:e("button",{className:"action-btn secondary",onClick:()=>E(t.filename),children:"\u{1F4E5} Download"})})]},t.filename))}):a("div",{className:"empty-state",children:[e("p",{children:"No archive files available yet."}),e("p",{children:"Archives will appear here after log rotation occurs."})]})]})]}),i==="maintenance"&&a(N,{children:[a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F527} Data Export & Backup"}),a("div",{className:"export-controls",children:[a("div",{className:"export-group",children:[e("h4",{children:"Export Logs"}),a("div",{className:"export-buttons",children:[e("button",{className:"action-btn secondary",onClick:()=>b("logs","json"),disabled:g,children:"JSON"}),e("button",{className:"action-btn secondary",onClick:()=>b("logs","csv"),disabled:g,children:"CSV"})]})]}),a("div",{className:"export-group",children:[e("h4",{children:"Export Monitoring Data"}),a("div",{className:"export-buttons",children:[e("button",{className:"action-btn secondary",onClick:()=>b("monitoring","json"),disabled:g,children:"JSON"}),e("button",{className:"action-btn secondary",onClick:()=>b("monitoring","csv"),disabled:g,children:"CSV"})]})]}),a("div",{className:"export-group",children:[e("h4",{children:"Full System Backup"}),e("div",{className:"export-buttons",children:e("button",{className:"action-btn primary",onClick:()=>b("backup","json"),disabled:g,children:"\u{1F4E6} Complete Backup"})}),e("p",{className:"help-text",children:"Includes all logs, monitoring data, sources, and configuration."})]})]})]}),(r||l)&&a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F4CA} System Overview"}),a("div",{className:"overview-grid",children:[r&&a("div",{className:"overview-card",children:[e("h4",{children:"Database"}),a("div",{className:"overview-stats",children:[a("div",{children:[r.logs.toLocaleString()," logs"]}),a("div",{children:[r.monitoring.toLocaleString()," monitoring entries"]}),a("div",{children:[r.sources.toLocaleString()," sources"]})]})]}),l&&a("div",{className:"overview-card",children:[e("h4",{children:"Archives"}),a("div",{className:"overview-stats",children:[a("div",{children:[l.totalArchives," archive files"]}),a("div",{children:[(l.totalSize/1024/1024).toFixed(2)," MB total"]})]})]})]})]})]}),a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F504} Auto-Refresh Settings"}),e("div",{className:"setting-row",children:a("label",{children:[e("input",{type:"checkbox",checked:x,onChange:t=>A(t.target.checked)}),"Enable auto-refresh"]})}),e("div",{className:"setting-row",children:a("label",{children:["Refresh interval:",a("select",{value:k,onChange:t=>F(Number(t.target.value)),disabled:!x,children:[e("option",{value:1e3,children:"1 second"}),e("option",{value:2e3,children:"2 seconds"}),e("option",{value:5e3,children:"5 seconds"}),e("option",{value:1e4,children:"10 seconds"}),e("option",{value:3e4,children:"30 seconds"})]})]})})]}),a("div",{className:"settings-section",children:[e("h3",{children:"\u{1F4CB} Server Information"}),a("div",{className:"setting-row",children:[e("span",{className:"label",children:"Intermediary Server:"}),e("span",{className:"value",children:"http://localhost:3002"})]}),a("div",{className:"setting-row",children:[e("span",{className:"label",children:"Viewer Port:"}),e("span",{className:"value",children:"3001"})]}),a("div",{className:"setting-row",children:[e("span",{className:"label",children:"FormWise Port:"}),e("span",{className:"value",children:"3003"})]})]}),i==="recipients"&&n&&a("div",{className:"settings-section",children:[a("h3",{children:["\u{1F50D} ",n.name," Details"]}),a("div",{className:"detail-view",children:[a("div",{className:"detail-row",children:[e("span",{className:"label",children:"ID:"}),e("span",{className:"value",children:n.id})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Type:"}),e("span",{className:"value",children:n.type})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Status:"}),e("span",{className:"value",children:n.status})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Total Logs:"}),e("span",{className:"value",children:n.logCount.toLocaleString()})]}),n.saveLogsDir&&a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Save Logs Directory:"}),e("span",{className:"value path",children:n.saveLogsDir})]}),a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Last Seen:"}),e("span",{className:"value",children:new Date(n.lastSeen||"").toLocaleString()})]}),n.lastLogTime&&a("div",{className:"detail-row",children:[e("span",{className:"label",children:"Last Log Time:"}),e("span",{className:"value",children:new Date(n.lastLogTime).toLocaleString()})]})]})]})]}),e("div",{className:"settings-footer",children:e("button",{className:"save-btn",onClick:y,children:"Close"})})]})}):null},W=B;export{W as default};
