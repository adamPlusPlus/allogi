import{useState as m,useEffect as L}from"react";import{jsx as o,jsxs as i}from"react/jsx-runtime";var P=()=>{let[s,b]=m(null),[d,x]=m(null),[y,w]=m(!0),[k,g]=m(null),[l,C]=m(!1),[S,F]=m(null),v=async()=>{try{w(!0);let n=N(),[e,t]=await Promise.all([fetch("/api/instrumentation/config"),fetch("/api/monitoring")]);if(e.ok){let a=await e.json(),r=n||a.config;b(r),n&&await fetch("/api/instrumentation/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:n})})}else n?b(n):g("Failed to fetch instrumentation configuration");if(t.ok){let a=await t.json();x(a)}else console.warn("Failed to fetch monitoring data");g(null)}catch{let e=N();e?(b(e),g(null)):g("Network error while fetching data")}finally{w(!1)}},N=()=>{try{let n=localStorage.getItem("allog-save-system");if(n){let e=JSON.parse(n);if(e.activeProfile){let t=e.activeProfile,a=e.items?.find(r=>r.id===t);if(a){F(a);let r=e.items?.find(c=>c.type==="profile-settings"&&c.parentId===t);if(r?.metadata?.data?.instrumentation)return r.metadata.data.instrumentation}}}}catch(n){console.warn("Failed to load profile instrumentation settings:",n)}return null},u=async n=>{try{C(!0),(await fetch("/api/instrumentation/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:n})})).ok?(b(n),await z(n),g(null)):g("Failed to save instrumentation configuration")}catch{g("Network error while saving configuration")}finally{C(!1)}},z=async n=>{try{let e=localStorage.getItem("allog-save-system");if(e){let t=JSON.parse(e);if(t.activeProfile){let a=t.activeProfile,r=t.items?.find(c=>c.type==="profile-settings"&&c.parentId===a);r?(r.metadata.data.instrumentation=n,r.metadata.updatedAt=new Date().toISOString()):(r={id:`profile-settings-${a}`,name:"Profile Settings",type:"profile-settings",parentId:a,metadata:{description:"Settings for profile",tags:["profile","settings","system"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{theme:"dark",autoSave:!0,notifications:!0,defaultView:"logs",instrumentation:n}}},t.items=t.items||[],t.items.push(r)),localStorage.setItem("allog-save-system",JSON.stringify(t))}}}catch(e){console.warn("Failed to save to profile:",e)}},h=async n=>{if(!s)return;let e={...s};switch(n){case"comprehensive":e.enabled=!0,e.defaultLevel="comprehensive",Object.keys(e.components).forEach(t=>{e.components[t].enabled=!0,e.components[t].level="comprehensive"}),Object.keys(e.methods).forEach(t=>{e.methods[t]=!0}),Object.keys(e.state).forEach(t=>{e.state[t]=!0}),Object.keys(e.dataFlow).forEach(t=>{e.dataFlow[t]=!0}),Object.keys(e.performance).forEach(t=>{e.performance[t]=!0});break;case"detailed":e.enabled=!0,e.defaultLevel="detailed",Object.keys(e.components).forEach(t=>{e.components[t].enabled=!0,e.components[t].level="detailed"}),e.methods.logMethodCalls=!0,e.methods.logMethodParameters=!0,e.methods.logMethodReturns=!0,e.methods.logMethodTiming=!1,e.methods.logMethodErrors=!0,e.state.logVariableChanges=!0,e.state.logConfigurationChanges=!0,e.state.logBufferOperations=!0,e.state.logModuleStateChanges=!1,e.state.logServerCommunication=!0,e.dataFlow.logDataTransformation=!0,e.dataFlow.logDataRouting=!0,e.dataFlow.logDataFiltering=!0,e.dataFlow.logDataSerialization=!1,e.performance.logExecutionTime=!0,e.performance.logMemoryUsage=!1,e.performance.logBufferStats=!0,e.performance.logServerLatency=!1;break;case"basic":e.enabled=!0,e.defaultLevel="basic",Object.keys(e.components).forEach(t=>{e.components[t].enabled=!0,e.components[t].level="basic"}),e.methods.logMethodCalls=!0,e.methods.logMethodParameters=!1,e.methods.logMethodReturns=!1,e.methods.logMethodTiming=!1,e.methods.logMethodErrors=!0,e.state.logVariableChanges=!1,e.state.logConfigurationChanges=!0,e.state.logBufferOperations=!1,e.state.logModuleStateChanges=!1,e.state.logServerCommunication=!1,e.dataFlow.logDataTransformation=!1,e.dataFlow.logDataRouting=!1,e.dataFlow.logDataFiltering=!1,e.dataFlow.logDataSerialization=!1,e.performance.logExecutionTime=!1,e.performance.logMemoryUsage=!1,e.performance.logBufferStats=!1,e.performance.logServerLatency=!1;break;case"none":e.enabled=!1,e.defaultLevel="none",Object.keys(e.components).forEach(t=>{e.components[t].enabled=!1,e.components[t].level="none"}),Object.keys(e.methods).forEach(t=>{e.methods[t]=!1}),Object.keys(e.state).forEach(t=>{e.state[t]=!1}),Object.keys(e.dataFlow).forEach(t=>{e.dataFlow[t]=!1}),Object.keys(e.performance).forEach(t=>{e.performance[t]=!1});break}await u(e)},f=async(n,e)=>{if(!s)return;let t={...s},a=n.split("."),r=t;for(let c=0;c<a.length-1;c++)r=r[a[c]];r[a[a.length-1]]=e,await u(t)},j=async(n,e)=>{if(!d)return;let t={...d.modules};if(t[n]={...t[n],level:e},x({...d,modules:t}),s){let a={...s};a.components||(a.components={}),a.components[n]?a.components[n].level=e:a.components[n]={enabled:!0,level:e,methods:[],excludeMethods:[]},await u(a)}},D=async(n,e)=>{if(!d)return;let t={...d.modules};if(t[n]={...t[n],enabled:e},x({...d,modules:t}),s){let a={...s};a.components||(a.components={}),a.components[n]?a.components[n].enabled=e:a.components[n]={enabled:e,level:"detailed",methods:[],excludeMethods:[]},await u(a)}};return L(()=>{v()},[]),y?o("div",{className:"instrumentation-page",children:o("div",{className:"loading",children:"Loading instrumentation configuration..."})}):k?o("div",{className:"instrumentation-page",children:i("div",{className:"error",children:[o("h3",{children:"Error"}),o("p",{children:k}),o("button",{onClick:v,children:"Retry"})]})}):s?i("div",{className:"instrumentation-page",children:[i("div",{className:"instrumentation-header",children:[o("h2",{children:"\u{1F527} Instrumentation Controls"}),o("p",{children:"Configure what gets logged in the Allog system"}),S&&o("div",{className:"profile-indicator",children:i("span",{className:"profile-badge",children:["\u{1F4C1} Settings auto-saved to profile: ",o("strong",{children:S.name})]})})]}),i("div",{className:"preset-section",children:[o("h3",{children:"Quick Presets"}),i("div",{className:"preset-buttons",children:[o("button",{className:"preset-btn comprehensive",onClick:()=>h("comprehensive"),disabled:l,children:"\u{1F50D} Comprehensive"}),o("button",{className:"preset-btn detailed",onClick:()=>h("detailed"),disabled:l,children:"\u{1F4CA} Detailed"}),o("button",{className:"preset-btn basic",onClick:()=>h("basic"),disabled:l,children:"\u{1F4DD} Basic"}),o("button",{className:"preset-btn none",onClick:()=>h("none"),disabled:l,children:"\u{1F6AB} None"})]})]}),i("div",{className:"config-section",children:[o("h3",{children:"Global Settings"}),i("div",{className:"config-grid",children:[o("div",{className:"config-item",children:i("label",{children:[o("input",{type:"checkbox",checked:s.enabled,onChange:n=>f("enabled",n.target.checked),disabled:l}),"Enable Instrumentation"]})}),i("div",{className:"config-item",children:[o("label",{children:"Default Level:"}),i("select",{value:s.defaultLevel,onChange:n=>f("defaultLevel",n.target.value),disabled:l,children:[o("option",{value:"none",children:"None"}),o("option",{value:"basic",children:"Basic"}),o("option",{value:"detailed",children:"Detailed"}),o("option",{value:"comprehensive",children:"Comprehensive"})]})]})]})]}),i("div",{className:"config-section",children:[i("h3",{children:["Active Components (",d?.stats.totalModules||0," discovered)"]}),d&&d.modules&&Object.keys(d.modules).length>0?o("div",{className:"components-table",children:i("table",{children:[o("thead",{children:i("tr",{children:[o("th",{children:"Module"}),o("th",{children:"Scripts"}),o("th",{children:"Variables"}),o("th",{children:"States"}),o("th",{children:"Functions"}),o("th",{children:"Properties"}),o("th",{children:"Events"}),o("th",{children:"Last Update"}),o("th",{children:"Level"}),o("th",{children:"Enabled"})]})}),o("tbody",{children:Object.entries(d.modules).map(([n,e])=>{let t=Object.keys(e.scripts||{}).length,a=0,r=0,c=0,E=0,M=0;Object.values(e.scripts||{}).forEach(p=>{a+=Object.keys(p.variables||{}).length,r+=Object.keys(p.states||{}).length,c+=Object.keys(p.functions||{}).length,E+=Object.keys(p.properties||{}).length,M+=Object.keys(p.events||{}).length});let O=s.components&&s.components[n]?s.components[n]:{enabled:!0,level:s.defaultLevel||"detailed"};return i("tr",{className:"module-row",children:[i("td",{className:"module-name",children:[o("span",{className:"module-icon",children:"\u{1F4E6}"}),n]}),o("td",{className:"module-scripts",children:t}),o("td",{className:"module-variables",children:a}),o("td",{className:"module-states",children:r}),o("td",{className:"module-functions",children:c}),o("td",{className:"module-properties",children:E}),o("td",{className:"module-events",children:M}),o("td",{className:"module-last-update",children:e.lastUpdate?new Date(e.lastUpdate).toLocaleString():"Never"}),o("td",{className:"module-level",children:i("select",{value:O.level,onChange:p=>j(n,p.target.value),disabled:l,className:"level-select",children:[o("option",{value:"none",children:"None"}),o("option",{value:"basic",children:"Basic"}),o("option",{value:"detailed",children:"Detailed"}),o("option",{value:"comprehensive",children:"Comprehensive"})]})}),o("td",{className:"module-enabled",children:o("input",{type:"checkbox",checked:O.enabled,onChange:p=>D(n,p.target.checked),disabled:l,className:"enabled-checkbox"})})]},n)})})]})}):i("div",{className:"no-components",children:[o("p",{children:"No active components detected. Components will appear here as they send logs."}),o("button",{onClick:v,disabled:y,children:"\u{1F504} Refresh Discovery"})]})]}),i("div",{className:"config-section",children:[o("h3",{children:"Method Logging"}),o("div",{className:"config-grid",children:Object.entries(s.methods||{}).map(([n,e])=>o("div",{className:"config-item",children:i("label",{children:[o("input",{type:"checkbox",checked:e,onChange:t=>f(`methods.${n}`,t.target.checked),disabled:l}),n.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())]})},n))})]}),i("div",{className:"config-section",children:[o("h3",{children:"State Logging"}),o("div",{className:"config-grid",children:Object.entries(s.state||{}).map(([n,e])=>o("div",{className:"config-item",children:i("label",{children:[o("input",{type:"checkbox",checked:e,onChange:t=>f(`state.${n}`,t.target.checked),disabled:l}),n.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())]})},n))})]}),i("div",{className:"config-section",children:[o("h3",{children:"Data Flow Logging"}),o("div",{className:"config-grid",children:Object.entries(s.dataFlow||{}).map(([n,e])=>o("div",{className:"config-item",children:i("label",{children:[o("input",{type:"checkbox",checked:e,onChange:t=>f(`dataFlow.${n}`,t.target.checked),disabled:l}),n.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())]})},n))})]}),i("div",{className:"config-section",children:[o("h3",{children:"Performance Logging"}),o("div",{className:"config-grid",children:Object.entries(s.performance||{}).map(([n,e])=>o("div",{className:"config-item",children:i("label",{children:[o("input",{type:"checkbox",checked:e,onChange:t=>f(`performance.${n}`,t.target.checked),disabled:l}),n.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())]})},n))})]}),l&&o("div",{className:"saving-indicator",children:"Saving configuration..."})]}):o("div",{className:"instrumentation-page",children:o("div",{className:"error",children:"No configuration available"})})},B=P;export{B as default};
