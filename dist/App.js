import{useState as Pe,useEffect as ut,useCallback as Le,useRef as Ct}from"react";import{useState as Te,useEffect as bt,useCallback as $t,useMemo as zt,useRef as Ft}from"react";import Mt,{useEffect as Ot,useRef as At}from"react";import{jsx as Ve,jsxs as ft}from"react/jsx-runtime";function at({isVisible:o,x:n,y:d,items:u,onClose:f}){let P=At(null);return Ot(()=>{let v=C=>{P.current&&!P.current.contains(C.target)&&f()};if(o)return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[o,f]),o?Ve("div",{ref:P,className:"context-menu",style:{left:n,top:d,position:"fixed",zIndex:1e3},onClick:v=>v.stopPropagation(),children:u.map((v,C)=>Ve(Mt.Fragment,{children:v.separator?Ve("div",{className:"context-menu-separator"}):ft("div",{className:`context-menu-item ${v.disabled?"disabled":""} ${v.submenu?"context-menu-item-submenu":""}`,onClick:()=>{v.disabled||(v.action(),f())},children:[v.icon&&Ve("span",{className:"context-menu-icon",children:v.icon}),Ve("span",{className:"context-menu-label",children:v.label}),v.submenu&&Ve("span",{className:"context-menu-arrow",children:"\u25B6"}),v.submenu&&Ve("div",{className:"context-submenu",children:v.submenu.map((z,X)=>ft("div",{className:`context-menu-item ${z.disabled?"disabled":""}`,onClick:R=>{R.stopPropagation(),z.disabled||(z.action(),f())},children:[z.icon&&Ve("span",{className:"context-menu-icon",children:z.icon}),Ve("span",{className:"context-menu-label",children:z.label})]},z.id||X))})]})},v.id||C))}):null}import{useState as Et,useCallback as ot}from"react";function nt(o={}){let[n,d]=Et({isVisible:!1,x:0,y:0}),u=ot((C,z,X,R)=>{d({isVisible:!0,x:C,y:z,targetData:X,targetElement:R})},[]),f=ot(()=>{d(C=>({...C,isVisible:!1}))},[]),P=ot(C=>{try{let X={id:`highlight-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Highlight: ${C.text?.substring(0,30)}...`||"Unnamed Highlight",type:"highlight",parentId:"default-highlight",metadata:{description:"Created from context menu",tags:C.tags||[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{text:C.text,sourceType:C.sourceType,timestamp:C.timestamp,scriptId:C.scriptId,moduleId:C.moduleId,additionalData:C.data}}};if(o.onCreateHighlight)o.onCreateHighlight(C);else{let R=localStorage.getItem("allog-save-system"),m=R?JSON.parse(R):{items:[]};m.items.push(X),localStorage.setItem("allog-save-system",JSON.stringify(m)),console.log("Highlight created and saved:",X.name)}return C}catch(z){return console.error("Failed to create highlight:",z),C}},[o.onCreateHighlight]),v=ot(C=>({id:"highlight",label:"Highlight",icon:"\u{1F4A1}",action:()=>P(C)}),[P]);return{contextMenu:n,showContextMenu:u,hideContextMenu:f,createHighlight:P,createHighlightMenuItem:v}}import{useState as ht,useEffect as Pt,useCallback as st}from"react";function it(){let[o,n]=ht([]),[d,u]=ht(new Map);Pt(()=>{let C=()=>{try{let R=localStorage.getItem("allog-save-system");if(R){let G=(JSON.parse(R).items?.filter(K=>K.type?.startsWith("highlight-")&&K.metadata?.highlightData)||[]).map(K=>({id:K.id,name:K.name,scriptId:K.metadata.highlightData.scriptId,moduleId:K.metadata.highlightData.moduleId,methodId:K.metadata.highlightData.methodId,valueId:K.metadata.highlightData.valueId,color:K.metadata.highlightData.color||"#ffff00",pattern:K.metadata.highlightData.pattern||"default",target:K.metadata.target||K.name||""}));n(G)}}catch{}};C();let z=R=>{R.key==="allog-save-system"&&C()};window.addEventListener("storage",z);let X=()=>{C()};return window.addEventListener("highlight-updated",X),()=>{window.removeEventListener("storage",z),window.removeEventListener("highlight-updated",X)}},[]);let f=st((C,z,X,R,m)=>o.find(N=>{if(N.scriptId&&z&&!z.includes(N.scriptId)||N.moduleId&&X&&!X.includes(N.moduleId)||N.valueId&&R&&!R.includes(N.valueId))return!1;if(C==="log"&&N.target&&m)return m.toLowerCase().includes(N.target.toLowerCase());if(R&&N.target)return R.toLowerCase().includes(N.target.toLowerCase());if(N.target){if(C==="log"&&m)return m.toLowerCase().includes(N.target.toLowerCase());if(R)return R.toLowerCase().includes(N.target.toLowerCase())}return!1})||null,[o]),P=st((C,z,X,R,m)=>{let N=f(C,z,X,R,m);if(!N)return{className:"",style:{},isHighlighted:!1};let G=`highlight-pattern-${N.pattern}`;return{className:`${C==="log"?"log-entry":C==="variable"||C==="state"||C==="function"||C==="property"||C==="event"?"monitoring-data-item":""} highlighted ${G}`,style:{"--highlight-color":N.color},isHighlighted:!0,highlight:N,dataAttributes:{"data-highlight-name":N.name}}},[f]),v=st(C=>{n(C)},[]);return{highlights:o,getHighlightForElement:f,getHighlightStyles:P,updateHighlights:v,isElementHighlighted:f}}import{jsx as w,jsxs as E}from"react/jsx-runtime";function lt({onStatsUpdate:o,onConnectionUpdate:n,saveSystemRef:d}){let{contextMenu:u,showContextMenu:f,hideContextMenu:P}=nt(),{getHighlightStyles:v,isElementHighlighted:C}=it(),z=Ft(new Map),[X,R]=Te({}),[m,N]=Te({totalModules:0,totalScripts:0,totalVariables:0,totalStates:0,totalFunctions:0,totalProperties:0,totalEvents:0,lastUpdate:new Date().toISOString()}),[G,K]=Te({isConnected:!1,retryCount:0}),[ae,re]=Te(!0),[ce,Ne]=Te(500),[J,b]=Te({moduleId:"",scriptId:"",type:"",search:"",showVariables:!0,showStates:!0,showFunctions:!0,showProperties:!0,showEvents:!0}),[i,a]=Te(new Set),[T,Q]=Te(new Set),[M,ge]=Te(null),[$,pe]=Te("table"),[se,h]=Te(null),Y=$t(async()=>{try{let l=await fetch("/api/monitoring");if(l.ok){let s=await l.json();R(s.modules||{});let O=s.stats||m;N(O);let k={...G,isConnected:!0,error:void 0};if(K(k),o?.(O),n?.(k),M){let F=s.modules?.[M.moduleId];if(F){let _=F.scripts?.[M.scriptId];if(_){let ue=_[M.type+"s"];ue&&ue[M.name]||ge(null)}else ge(null)}else ge(null)}}}catch(l){console.error("Failed to fetch monitoring data:",l);let s={...G,isConnected:!1,error:"Connection failed",retryCount:G.retryCount+1};K(s),n?.(s)}},[m,M]);bt(()=>{if(!ae)return;let l=setInterval(Y,ce);return()=>clearInterval(l)},[ae,ce,Y]),bt(()=>{Y()},[Y]);let ee=zt(()=>{let l={};return!X||typeof X!="object"||Object.entries(X).forEach(([s,O])=>{if(J.moduleId&&!s.includes(J.moduleId)||!O||!O.scripts||typeof O.scripts!="object")return;let k={};Object.entries(O.scripts).forEach(([F,_])=>{if(J.scriptId&&!F.includes(J.scriptId)||!_||typeof _!="object")return;let ue={variables:{},states:{},functions:{},properties:{},events:{},lastUpdate:_.lastUpdate||Date.now()};J.showVariables&&_.variables&&typeof _.variables=="object"&&Object.entries(_.variables).forEach(([me,De])=>{J.search&&!me.toLowerCase().includes(J.search.toLowerCase())||(ue.variables[me]=De)}),J.showStates&&_.states&&typeof _.states=="object"&&Object.entries(_.states).forEach(([me,De])=>{J.search&&!me.toLowerCase().includes(J.search.toLowerCase())||(ue.states[me]=De)}),J.showFunctions&&_.functions&&typeof _.functions=="object"&&Object.entries(_.functions).forEach(([me,De])=>{J.search&&!me.toLowerCase().includes(J.search.toLowerCase())||(ue.functions[me]=De)}),J.showProperties&&_.properties&&typeof _.properties=="object"&&Object.entries(_.properties).forEach(([me,De])=>{J.search&&!me.toLowerCase().includes(J.search.toLowerCase())||(ue.properties[me]=De)}),J.showEvents&&_.events&&typeof _.events=="object"&&Object.entries(_.events).forEach(([me,De])=>{J.search&&!me.toLowerCase().includes(J.search.toLowerCase())||(ue.events[me]=De)}),Object.values(ue).some(me=>typeof me=="object"&&Object.keys(me).length>0)&&(k[F]=ue)}),Object.keys(k).length>0&&(l[s]={...O,scripts:k})}),l},[X,J]),Ie=l=>{let s=new Set(i);s.has(l)?s.delete(l):s.add(l),a(s)},be=l=>{let s=new Set(T);s.has(l)?s.delete(l):s.add(l),Q(s)},ve=l=>{if(l===null)return"null";if(l===void 0)return"undefined";if(typeof l=="object")try{return JSON.stringify(l,null,2)}catch{return"[Complex Object]"}return String(l)},Z=l=>l===null?"null":l===void 0?"undefined":Array.isArray(l)?"array":typeof l,c=l=>{let O=Date.now()-l;return O<1e3?"just now":O<6e4?`${Math.floor(O/1e3)}s ago`:O<36e5?`${Math.floor(O/6e4)}m ago`:`${Math.floor(O/36e5)}h ago`},oe=l=>{let s="asc";se&&se.key===l&&se.direction==="asc"&&(s="desc"),h({key:l,direction:s})},Ae=l=>se?[...l].sort((s,O)=>{let k,F;switch(se.key){case"moduleId":k=s.moduleId.toLowerCase(),F=O.moduleId.toLowerCase();break;case"scriptId":k=s.scriptId.toLowerCase(),F=O.scriptId.toLowerCase();break;case"name":k=s.name.toLowerCase(),F=O.name.toLowerCase();break;case"type":k=s.type.toLowerCase(),F=O.type.toLowerCase();break;case"value":k=ve(s.value).toLowerCase(),F=ve(O.value).toLowerCase();break;case"timestamp":k=s.timestamp,F=O.timestamp;break;default:return 0}return k<F?se.direction==="asc"?-1:1:k>F?se.direction==="asc"?1:-1:0}):l,xe=l=>!se||se.key!==l?"\u2195\uFE0F":se.direction==="asc"?"\u2191":"\u2193",Me=()=>{if(!M)return;let l={basicInformation:{name:M.name,type:M.type,timestamp:new Date(M.timestamp).toLocaleString(),moduleId:M.moduleId,scriptId:M.scriptId},valueInformation:{currentValue:M.value,previousValue:M.previousValue,valueType:Z(M.value)},metadata:M.metadata||{}},s=JSON.stringify(l,null,2);navigator.clipboard.writeText(s).then(()=>{}).catch(O=>{})},ze=(l,s)=>{l.preventDefault();let O=`${s.moduleId}-${s.scriptId}-${s.name}`,k=z.current.get(O),F=Date.now();if(k&&F-k.lastClick<300){k.timeout&&clearTimeout(k.timeout),z.current.delete(O);return}let _=setTimeout(()=>{z.current.delete(O)},300);z.current.set(O,{lastClick:F,timeout:_}),f(l.clientX,l.clientY,{id:"monitoring-data",label:`Data: ${s.name}`,icon:"\u{1F4CA}",action:()=>{}})},Ee=(l,s)=>{l.preventDefault();let O=`table-row-${s.moduleId}-${s.scriptId}-${s.name}`,k=z.current.get(O),F=Date.now();if(k&&F-k.lastClick<300){k.timeout&&clearTimeout(k.timeout),z.current.delete(O);return}let _=setTimeout(()=>{z.current.delete(O)},300);z.current.set(O,{lastClick:F,timeout:_}),f(l.clientX,l.clientY,{id:"table-row",label:`Row: ${s.name}`,icon:"\u{1F4CB}",action:()=>{}})},Ue=(l,s)=>{let O=v(l.type,l.scriptId,l.moduleId,l.name);return E("div",{className:`monitoring-data-item monitoring-data-${l.type} ${O.className}`,style:O.style,onClick:()=>ge(l),onContextMenu:k=>ze(k,l),...O.dataAttributes,children:[E("div",{className:"data-header",children:[w("span",{className:"data-name",children:l.name}),w("span",{className:`data-type data-type-${l.type}`,children:l.type}),w("span",{className:"data-time",children:c(l.timestamp)})]}),E("div",{className:"data-content",children:[E("div",{className:"data-value",children:[w("span",{className:"value-label",children:"Value:"}),w("span",{className:`value-content value-${Z(l.value)}`,children:ve(l.value)})]}),l.previousValue!==void 0&&E("div",{className:"data-previous",children:[w("span",{className:"value-label",children:"Previous:"}),w("span",{className:`value-content value-${Z(l.previousValue)}`,children:ve(l.previousValue)})]}),l.metadata&&E("div",{className:"data-metadata",children:[l.metadata.file&&E("span",{className:"metadata-item",children:["\u{1F4C1} ",l.metadata.file,":",l.metadata.line]}),l.metadata.functionName&&E("span",{className:"metadata-item",children:["\u{1F527} ",l.metadata.functionName]}),l.metadata.duration&&E("span",{className:"metadata-item",children:["\u23F1\uFE0F ",l.metadata.duration,"ms"]})]})]})]},s)},Qe=()=>w("div",{className:"monitoring-tree",children:Object.entries(ee).map(([l,s])=>E("div",{className:"module-container",children:[E("div",{className:"module-header",onClick:()=>Ie(l),children:[w("span",{className:"expand-icon",children:i.has(l)?"\u25BC":"\u25B6"}),w("span",{className:"module-name",children:l}),E("span",{className:"module-stats",children:[Object.keys(s.scripts).length," scripts"]})]}),i.has(l)&&w("div",{className:"module-content",children:Object.entries(s.scripts).map(([O,k])=>E("div",{className:"script-container",children:[E("div",{className:"script-header",onClick:()=>be(O),children:[w("span",{className:"expand-icon",children:T.has(O)?"\u25BC":"\u25B6"}),w("span",{className:"script-name",children:O}),E("span",{className:"script-stats",children:[(k.variables?Object.keys(k.variables).length:0)+(k.states?Object.keys(k.states).length:0)+(k.functions?Object.keys(k.functions).length:0)+(k.properties?Object.keys(k.properties).length:0)+(k.events?Object.keys(k.events).length:0)," items"]})]}),T.has(O)&&E("div",{className:"script-content",children:[J.showVariables&&k.variables&&Object.keys(k.variables).length>0&&E("div",{className:"data-category",children:[w("h4",{children:"Variables"}),Object.entries(k.variables).map(([F,_])=>Ue(_,`var-${O}-${F}`))]}),J.showStates&&k.states&&Object.keys(k.states).length>0&&E("div",{className:"data-category",children:[w("h4",{children:"States"}),Object.entries(k.states).map(([F,_])=>Ue(_,`state-${O}-${F}`))]}),J.showFunctions&&k.functions&&Object.keys(k.functions).length>0&&E("div",{className:"data-category",children:[w("h4",{children:"Functions"}),Object.entries(k.functions).map(([F,_])=>Ue(_,`func-${O}-${F}`))]}),J.showProperties&&k.properties&&Object.keys(k.properties).length>0&&E("div",{className:"data-category",children:[w("h4",{children:"Properties"}),Object.entries(k.properties).map(([F,_])=>Ue(_,`prop-${O}-${F}`))]}),J.showEvents&&k.events&&Object.keys(k.events).length>0&&E("div",{className:"data-category",children:[w("h4",{children:"Events"}),Object.entries(k.events).map(([F,_])=>Ue(_,`event-${O}-${F}`))]})]})]},O))})]},l))}),_e=()=>{let l=[];return Object.entries(ee).forEach(([s,O])=>{!O||!O.scripts||Object.entries(O.scripts).forEach(([k,F])=>{!F||typeof F!="object"||Object.entries(F).forEach(([_,ue])=>{_!=="lastUpdate"&&ue&&typeof ue=="object"&&Object.entries(ue).forEach(([Ge,me])=>{if(me&&typeof me=="object"&&"value"in me){let De=_.slice(0,-1);l.push({moduleId:s,scriptId:k,name:Ge,type:De,value:me.value,timestamp:me.timestamp||Date.now(),metadata:me.metadata})}})})})}),w("div",{className:"monitoring-table",children:E("table",{children:[w("thead",{children:E("tr",{children:[E("th",{className:`sortable ${se?.key==="moduleId"?"sorted":""}`,onClick:()=>oe("moduleId"),children:["Module",w("span",{className:"sort-indicator",children:xe("moduleId")})]}),E("th",{className:`sortable ${se?.key==="scriptId"?"sorted":""}`,onClick:()=>oe("scriptId"),children:["Script",w("span",{className:"sort-indicator",children:xe("scriptId")})]}),E("th",{className:`sortable ${se?.key==="name"?"sorted":""}`,onClick:()=>oe("name"),children:["Name",w("span",{className:"sort-indicator",children:xe("name")})]}),E("th",{className:`sortable ${se?.key==="type"?"sorted":""}`,onClick:()=>oe("type"),children:["Type",w("span",{className:"sort-indicator",children:xe("type")})]}),E("th",{className:`sortable ${se?.key==="value"?"sorted":""}`,onClick:()=>oe("value"),children:["Value",w("span",{className:"sort-indicator",children:xe("value")})]}),w("th",{children:"Context"}),E("th",{className:`sortable ${se?.key==="timestamp"?"sorted":""}`,onClick:()=>oe("timestamp"),children:["Time",w("span",{className:"sort-indicator",children:xe("timestamp")})]})]})}),w("tbody",{children:Ae(l).map((s,O)=>{let k=v(s.type,s.scriptId,s.moduleId,s.name);return E("tr",{className:`table-row table-row-${s.type} ${k.className}`,style:k.style,onClick:()=>ge({moduleId:s.moduleId,scriptId:s.scriptId,name:s.name,type:s.type,value:s.value,timestamp:s.timestamp}),onContextMenu:F=>Ee(F,s),...k.dataAttributes,children:[w("td",{className:"table-module",children:s.moduleId}),w("td",{className:"table-script",children:s.scriptId}),w("td",{className:"table-name",children:s.name}),w("td",{children:w("span",{className:`table-type table-type-${s.type}`,children:s.type})}),w("td",{className:"table-value",children:ve(s.value)}),w("td",{className:"table-context",children:s.metadata&&E("div",{className:"context-info",children:[s.metadata.file&&E("span",{className:"context-file",title:`File: ${s.metadata.file}:${s.metadata.line||""}`,children:["\u{1F4C1} ",s.metadata.file.split("/").pop(),":",s.metadata.line]}),s.metadata.functionName&&E("span",{className:"context-function",title:`Function: ${s.metadata.functionName}`,children:["\u{1F527} ",s.metadata.functionName]}),s.metadata.duration&&E("span",{className:"context-duration",title:`Duration: ${s.metadata.duration}ms`,children:["\u23F1\uFE0F ",s.metadata.duration,"ms"]})]})}),w("td",{className:"table-time",children:c(s.timestamp)})]},`${s.moduleId}-${s.scriptId}-${s.name}-${O}`)})})]})})},et=()=>{let l=[];return Object.entries(ee).forEach(([s,O])=>{!O||!O.scripts||Object.entries(O.scripts).forEach(([k,F])=>{!F||typeof F!="object"||(F.variables&&typeof F.variables=="object"&&Object.entries(F.variables).forEach(([_,ue])=>l.push({moduleId:s,scriptId:k,data:ue})),F.states&&typeof F.states=="object"&&Object.entries(F.states).forEach(([_,ue])=>l.push({moduleId:s,scriptId:k,data:ue})),F.functions&&typeof F.functions=="object"&&Object.entries(F.functions).forEach(([_,ue])=>l.push({moduleId:s,scriptId:k,data:ue})),F.properties&&typeof F.properties=="object"&&Object.entries(F.properties).forEach(([_,ue])=>l.push({moduleId:s,scriptId:k,data:ue})),F.events&&typeof F.events=="object"&&Object.entries(F.events).forEach(([_,ue])=>l.push({moduleId:s,scriptId:k,data:ue})))})}),l.sort((s,O)=>O.data.timestamp-s.data.timestamp),w("div",{className:"monitoring-timeline",children:l.map((s,O)=>{let k=v(s.data.type,s.data.scriptId,s.data.moduleId,s.data.name);return E("div",{className:`timeline-item timeline-${s.data.type} ${k.className}`,style:k.style,onClick:()=>ge(s.data),...k.dataAttributes,children:[w("div",{className:"timeline-time",children:new Date(s.data.timestamp).toLocaleTimeString()}),E("div",{className:"timeline-content",children:[E("div",{className:"timeline-header",children:[w("span",{className:"timeline-module",children:s.moduleId}),w("span",{className:"timeline-script",children:s.scriptId}),w("span",{className:"timeline-name",children:s.data.name}),w("span",{className:`timeline-type timeline-type-${s.data.type}`,children:s.data.type})]}),w("div",{className:"timeline-value",children:ve(s.data.value)})]})]},O)})})};return E("div",{className:"monitoring-page",children:[E("div",{className:"monitoring-filters",children:[E("div",{className:"filter-group",children:[w("input",{type:"text",placeholder:"Filter by module...",value:J.moduleId,onChange:l=>b(s=>({...s,moduleId:l.target.value})),className:"filter-input"}),w("input",{type:"text",placeholder:"Filter by script...",value:J.scriptId,onChange:l=>b(s=>({...s,scriptId:l.target.value})),className:"filter-input"}),w("input",{type:"text",placeholder:"Search...",value:J.search,onChange:l=>b(s=>({...s,search:l.target.value})),className:"filter-input"})]}),E("div",{className:"filter-group",children:[E("label",{children:[w("input",{type:"checkbox",checked:J.showVariables,onChange:l=>b(s=>({...s,showVariables:l.target.checked}))}),"Variables"]}),E("label",{children:[w("input",{type:"checkbox",checked:J.showStates,onChange:l=>b(s=>({...s,showStates:l.target.checked}))}),"States"]}),E("label",{children:[w("input",{type:"checkbox",checked:J.showFunctions,onChange:l=>b(s=>({...s,showFunctions:l.target.checked}))}),"Functions"]}),E("label",{children:[w("input",{type:"checkbox",checked:J.showProperties,onChange:l=>b(s=>({...s,showProperties:l.target.checked}))}),"Properties"]}),E("label",{children:[w("input",{type:"checkbox",checked:J.showEvents,onChange:l=>b(s=>({...s,showEvents:l.target.checked}))}),"Events"]})]}),E("div",{className:"view-mode-controls",children:[w("button",{className:`view-mode-btn ${$==="tree"?"active":""}`,onClick:()=>pe("tree"),children:"Tree"}),w("button",{className:`view-mode-btn ${$==="table"?"active":""}`,onClick:()=>pe("table"),children:"Table"}),w("button",{className:`view-mode-btn ${$==="timeline"?"active":""}`,onClick:()=>pe("timeline"),children:"Timeline"})]})]}),E("div",{className:"monitoring-content",children:[E("div",{className:"monitoring-main",children:[$==="tree"&&Qe(),$==="table"&&_e(),$==="timeline"&&et()]}),M&&E("div",{className:"monitoring-detail",children:[E("div",{className:"detail-header",children:[w("h3",{children:"Data Details"}),E("div",{className:"detail-header-controls",children:[w("button",{className:"copy-btn",onClick:Me,title:"Copy data to clipboard",children:"\u{1F4CB} Copy"}),w("button",{className:"close-btn",onClick:()=>ge(null),children:"\xD7"})]})]}),E("div",{className:"detail-content",children:[E("div",{className:"detail-section",children:[w("h4",{children:"Basic Information"}),E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Name:"}),w("span",{className:"detail-value",children:M.name})]}),E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Type:"}),w("span",{className:`detail-value detail-type-${M.type}`,children:M.type})]}),E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Timestamp:"}),w("span",{className:"detail-value",children:new Date(M.timestamp).toLocaleString()})]})]}),E("div",{className:"detail-section",children:[w("h4",{children:"Value Information"}),E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Current Value:"}),w("div",{className:"detail-value-container",children:w("span",{className:`detail-value detail-value-${Z(M.value)}`,children:ve(M.value)})})]}),M.previousValue!==void 0&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Previous Value:"}),w("div",{className:"detail-value-container",children:w("span",{className:`detail-value detail-value-${Z(M.previousValue)}`,children:ve(M.previousValue)})})]})]}),M.metadata&&E("div",{className:"detail-section",children:[w("h4",{children:"Metadata"}),M.metadata.file&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"File:"}),E("span",{className:"detail-value",children:[M.metadata.file,":",M.metadata.line]})]}),M.metadata.functionName&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Function:"}),w("span",{className:"detail-value",children:M.metadata.functionName})]}),M.metadata.duration&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Duration:"}),E("span",{className:"detail-value",children:[M.metadata.duration,"ms"]})]}),M.metadata.error&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Error:"}),w("span",{className:"detail-value detail-error",children:M.metadata.error})]}),M.metadata.stack&&E("div",{className:"detail-item",children:[w("span",{className:"detail-label",children:"Stack:"}),w("pre",{className:"detail-stack",children:M.metadata.stack})]})]})]})]},`${M.moduleId}-${M.scriptId}-${M.name}-${M.timestamp}`)]}),w(at,{isVisible:u.isVisible,x:u.x,y:u.y,items:(()=>{let l=u.targetData?C(u.targetData.data?.type||"variable",u.targetData.scriptId,u.targetData.moduleId,u.targetData.data?.name):null;return[{id:"highlight",label:l?"Remove Highlight":"Highlight",icon:l?"\u274C":"\u{1F4A1}",action:()=>{u.targetData&&d?.current&&(l?d.current.removeHighlightForElement({elementType:u.targetData.data?.type||"variable",scriptId:u.targetData.scriptId,moduleId:u.targetData.moduleId,name:u.targetData.data?.name}):d.current.createHighlightFromData(u.targetData))}}]})(),onClose:P})]})}import{useState as Be,useEffect as yt,useCallback as Je}from"react";var ct=class{constructor(n){this.serverUrl=n}async requestText(n,d){let u=await fetch(`${this.serverUrl}${n}`,d);if(!u.ok)throw new Error(`HTTP ${u.status}`);return u.text()}parseJsonFromText(n){try{let d=n.indexOf("{");return d===-1?{}:JSON.parse(n.slice(d))}catch{return{}}}async getLogs(){let n=await this.requestText("/api/logs");return(this.parseJsonFromText(n).logs||[]).map(f=>({...f,timestamp:f.timestamp||f.time||f.serverReceivedAt}))}async clearLogs(){await fetch(`${this.serverUrl}/api/logs`,{method:"DELETE"})}async exportLogs(){let n=await fetch(`${this.serverUrl}/api/export?format=csv`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.text()}async getStats(){let n=await this.getLogs();return{totalLogs:n.length,byLevel:n.reduce((d,u)=>(d[u.level]=(d[u.level]||0)+1,d),{}),byScript:n.reduce((d,u)=>{let f=u.scriptId||"unknown";return d[f]=(d[f]||0)+1,d},{})}}async healthCheck(){try{return(await fetch(`${this.serverUrl}/api/status`)).ok}catch{return!1}}async sendRawLog(n,d="info"){let u=await fetch(`${this.serverUrl}/api/logs/raw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!u.ok)throw new Error(`HTTP ${u.status}`);return u.json()}async sendTextLog(n,d="info"){let u=await fetch(`${this.serverUrl}/api/logs/text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,level:d})});if(!u.ok)throw new Error(`HTTP ${u.status}`);return u.json()}async sendTextLogGet(n,d="info",u){let f=new URLSearchParams({text:n,level:d});u&&f.append("source",u);let P=await fetch(`${this.serverUrl}/api/logs/text?${f}`);if(!P.ok)throw new Error(`HTTP ${P.status}`);return P.json()}async getRecursiveLogs(){return this.getLogs()}async getRecursiveLogsStats(){let n=await this.getStats();return{totalRecursiveLogs:n.totalLogs,byScript:n.byScript,byLevel:n.byLevel}}async getLevelColor(n){switch(n){case"error":return"#ff4444";case"warn":return"#ffaa00";case"info":return"#44aa44";case"debug":return"#888888";default:return"#cccccc"}}async getScriptColor(n){let d=["#4ec9b0","#569cd6","#dcdcaa","#ce9178","#c586c0","#6a9955","#d7ba7d","#9cdcfe","#f44747","#ff7f50"],u=(n||"").split("").reduce((f,P)=>(f=(f<<5)-f+P.charCodeAt(0),f&f),0);return d[Math.abs(u)%d.length]}async formatTime(n){try{return new Date(n).toLocaleTimeString()}catch{return String(n||"")}}};function vt(o){return new ct(o)}var xt={network:{ports:{viewer:3001,server:3002},urls:{defaultServer:"http://localhost:3002",alternativeServer:"http://localhost:8080",productionServer:"https://api.example.com/allog"},connection:{timeout:5e3,retries:3,minTimeout:1e3,maxTimeout:3e4,retryDelay:1e3}},refresh:{intervals:{default:3e4,minimum:1e3,options:[1e3,2e3,5e3,1e4,3e4]},autoRefresh:{enabled:!1,minInterval:3e4}},logging:{levels:{valid:["info","warn","error","debug","test"],default:"info",colors:{info:"#007AFF",warn:"#FF9500",error:"#FF3B30",debug:"#888888",test:"#6c757d"}},internal:{maxLogs:1e3,enableConsole:!0,defaultLevel:"info"}},ui:{colors:{status:{connected:"#28a745",error:"#dc3545",neutral:"#6c757d",warning:"#FF9500"},script:["#4ec9b0","#569cd6","#dcdcaa","#ce9178","#c586c0","#6a9955","#d7ba7d","#9cdcfe","#f44747","#ff7f50"]},layout:{imagePreview:{maxWidth:"100%",maxHeight:300,borderRadius:4},notification:{autoHideDelay:3e3,fadeOutDuration:300}}},buffers:{logs:{default:500,maximum:1e4},stats:{enabledModules:0,totalModules:0}},instrumentation:{levels:{none:"none",basic:"basic",detailed:"detailed",comprehensive:"comprehensive"},defaults:{enabled:!0,level:"detailed"}},defaults:{fallback:{sourceId:"unknown",scriptId:"unknown",sourceType:"unknown",sourceVersion:"1.0.0"},messages:{loading:"Loading logs...",noLogs:"No logs available",noMatching:"No logs match your current filters",disconnected:"Not connected to server",connectionFailed:"Connection failed"}},export:{formats:["csv","json"],filenamePrefixes:{logs:"allog-logs",stats:"allog-stats",config:"allog-config"}}};var dt=class{constructor(){this.config=xt}get viewerPort(){return this.config.network.ports.viewer}get serverPort(){return this.config.network.ports.server}get defaultServerUrl(){return this.config.network.urls.defaultServer}get alternativeServerUrl(){return this.config.network.urls.alternativeServer}get productionServerUrl(){return this.config.network.urls.productionServer}get connectionTimeout(){return this.config.network.connection.timeout}get connectionRetries(){return this.config.network.connection.retries}get minTimeout(){return this.config.network.connection.minTimeout}get maxTimeout(){return this.config.network.connection.maxTimeout}get defaultRefreshInterval(){return this.config.refresh.intervals.default}get minRefreshInterval(){return this.config.refresh.intervals.minimum}get refreshOptions(){return this.config.refresh.intervals.options}get autoRefreshEnabled(){return this.config.refresh.autoRefresh.enabled}get minAutoRefreshInterval(){return this.config.refresh.autoRefresh.minInterval}get validLogLevels(){return this.config.logging.levels.valid}get defaultLogLevel(){return this.config.logging.levels.default}get logLevelColors(){return this.config.logging.levels.colors}get maxInternalLogs(){return this.config.logging.internal.maxLogs}get enableConsoleLogging(){return this.config.logging.internal.enableConsole}get defaultInternalLogLevel(){return this.config.logging.internal.defaultLevel}get statusColors(){return this.config.ui.colors.status}get scriptColors(){return this.config.ui.colors.script}get imagePreviewConfig(){return this.config.ui.layout.imagePreview}get notificationConfig(){return this.config.ui.layout.notification}get defaultLogBuffer(){return this.config.buffers.logs.default}get maxLogBuffer(){return this.config.buffers.logs.maximum}get instrumentationLevels(){return this.config.instrumentation.levels}get defaultInstrumentationEnabled(){return this.config.instrumentation.defaults.enabled}get defaultInstrumentationLevel(){return this.config.instrumentation.defaults.level}get fallbackValues(){return this.config.defaults.fallback}get defaultMessages(){return this.config.defaults.messages}get exportFormats(){return this.config.export.formats}get exportFilenamePrefixes(){return this.config.export.filenamePrefixes}isValidLogLevel(n){return this.validLogLevels.includes(n)}getLogLevelColor(n){return this.logLevelColors[n]||this.statusColors.neutral}getScriptColor(n){let d=this.scriptColors,f=(n||this.fallbackValues.scriptId).split("").reduce((P,v)=>(P=(P<<5)-P+v.charCodeAt(0),P&P),0);return d[Math.abs(f)%d.length]}getStatusColor(n){return this.statusColors[n]||this.statusColors.neutral}getConnectionConfig(){return{baseUrl:this.defaultServerUrl,timeout:this.connectionTimeout,retries:this.connectionRetries}}getWebSocketUrl(n){let d=window.location.protocol==="https:"?"wss":"ws",u=window.location.hostname,f=n||window.location.port,P=f===this.viewerPort.toString()?this.serverPort.toString():f||this.serverPort.toString();return`${d}://${u}:${P}`}getApiServerUrl(){let n=window.location.hostname,u=window.location.port===this.serverPort.toString()?this.viewerPort.toString():this.serverPort.toString();return`http://${n}:${u}`}formatMessage(n,d={}){return(this.defaultMessages[n]||n).replace(/\{(\w+)\}/g,(f,P)=>d[P]||f)}getServerUrl(){return window.ALLOG_INTERMEDIARY_URL||this.defaultServerUrl}getInitialLogStats(){return{totalLogs:0,bufferSize:this.defaultLogBuffer,enabledModules:this.config.buffers.stats.enabledModules,totalModules:this.config.buffers.stats.totalModules,logLevels:this.validLogLevels.reduce((n,d)=>(n[d]=0,n),{}),lastUpdate:new Date().toISOString()}}getInitialConnectionStatus(){return{isConnected:!1,retryCount:0}}getInitialMonitoringStats(){return{totalModules:0,totalScripts:0,totalVariables:0,totalStates:0,totalFunctions:0,totalProperties:0,totalEvents:0,lastUpdate:new Date().toISOString()}}},Tt=new dt,fe=Tt;import{jsx as te,jsxs as de}from"react/jsx-runtime";function pt({serverUrl:o,autoRefresh:n,refreshInterval:d}){let[u,f]=Be([]),[P,v]=Be({level:"",scriptId:"",search:""}),[C,z]=Be(new Set),[X,R]=Be(!1),[m,N]=Be(null),[G,K]=Be({totalRecursiveLogs:0,byScript:{},byLevel:{}}),[ae,re]=Be(null),[ce,Ne]=Be(null),[J]=Be(()=>vt(o)),b=Je(async()=>{console.log("\u{1F504} RecursiveLogsPage: Fetching logs from server:",o);let c=await J.getRecursiveLogs();return console.log("\u2705 RecursiveLogsPage: Received logs:",c.length,"logs"),c},[J,o]),i=Je(async()=>{let c=await J.getRecursiveLogsStats();return console.log("\u{1F4CA} RecursiveLogsPage: Received stats:",c),c},[J]),a=Je(async()=>{try{let c=await b();f(c),R(!0),N(null);let oe=await i();K(oe)}catch(c){console.error("\u274C RecursiveLogsPage: Error fetching logs:",c),N(`Connection failed: ${c instanceof Error?c.message:"Unknown error"}`),R(!1)}},[b,i]),T=Je(()=>{console.log("\u{1F504} RecursiveLogsPage: Component mounted")},[]),Q=Je(()=>{console.log("\u{1F504} RecursiveLogsPage: Component unmounting")},[]);yt(()=>{if(!n)return;let c=Math.max(d,3e4),oe=setInterval(()=>{a()},c);return()=>clearInterval(oe)},[n,d,a]),yt(()=>{T(),a();let c=setInterval(()=>{console.log("\u{1F504} RecursiveLogsPage: Periodic activity heartbeat",{component:"RecursiveLogsPage",timestamp:Date.now(),logCount:u.length})},6e4);return()=>{clearInterval(c),Q()}},[a,T,Q]);let M=Je(c=>{z(oe=>{let Ae=new Set(oe);return Ae.has(c)?Ae.delete(c):Ae.add(c),Ae}),console.log("\u{1F504} RecursiveLogsPage: User interaction - Log expansion toggled",{action:"toggleLogExpansion",logId:c,timestamp:Date.now()})},[]),ge=Je(c=>{re(c)},[]),$=Je(c=>{Ne(oe=>oe?.key===c?{key:c,direction:oe.direction==="asc"?"desc":"asc"}:{key:c,direction:"asc"}),console.log("\u{1F504} RecursiveLogsPage: User interaction - Logs sorted",{action:"requestSort",sortKey:c,timestamp:Date.now()})},[]),pe=c=>ce?.key!==c?"\u2195\uFE0F":ce.direction==="asc"?"\u2191":"\u2193",se=c=>ce?[...c].sort((oe,Ae)=>{let xe=oe[ce.key],Me=Ae[ce.key];return ce.key==="time"?(xe=new Date(xe).getTime(),Me=new Date(Me).getTime()):typeof xe=="string"&&(xe=xe.toLowerCase(),Me=Me.toLowerCase()),xe<Me?ce.direction==="asc"?-1:1:xe>Me?ce.direction==="asc"?1:-1:0}):c,h=u.filter(c=>!(P.level&&c.level!==P.level||P.scriptId&&c.scriptId!==P.scriptId||P.search&&!c.message.toLowerCase().includes(P.search.toLowerCase()))),Y=se(h),ee=Array.from(new Set(u.map(c=>c.scriptId))).sort(),Ie=fe.validLogLevels,be=c=>fe.getLogLevelColor(c),ve=c=>fe.getScriptColor(c||fe.fallbackValues.scriptId),Z=c=>new Date(c).toLocaleTimeString();return de("div",{className:"recursive-logs-page",children:[de("div",{className:"recursive-logs-header",children:[te("h2",{children:"\u{1F504} Recursive Logs"}),te("p",{className:"recursive-logs-description",children:"Self-referential logs from the Allog system itself. These logs show how the logging system operates."}),de("div",{className:"recursive-logs-status",children:[te("span",{className:"status-indicator",children:"\u{1F504} Active Filtering"}),te("span",{className:"status-detail",children:"Showing only self-logging scripts"})]})]}),de("div",{className:"recursive-logs-stats",children:[de("div",{className:"stat-card",children:[te("div",{className:"stat-number",children:G.totalRecursiveLogs}),te("div",{className:"stat-label",children:"Total Recursive Logs"})]}),de("div",{className:"stat-card",children:[te("div",{className:"stat-number",children:Object.keys(G.byScript).length}),te("div",{className:"stat-label",children:"Self-Logging Scripts"})]}),de("div",{className:"stat-card",children:[te("div",{className:"stat-number",children:Object.keys(G.byLevel).length}),te("div",{className:"stat-label",children:"Log Levels"})]})]}),de("div",{className:"recursive-logs-content",children:[de("div",{className:"recursive-logs-table-column",children:[de("div",{className:"recursive-logs-table-header",children:[te("h3",{children:"\u{1F4CA} Recursive Logs Table"}),te("button",{className:"refresh-btn",onClick:a,disabled:!X,children:"\u{1F504} Refresh"})]}),te("div",{className:"recursive-logs-table",children:de("table",{children:[te("thead",{children:de("tr",{children:[de("th",{className:"sortable",onClick:()=>$("scriptId"),children:["Script ",pe("scriptId")]}),de("th",{className:"sortable",onClick:()=>$("level"),children:["Level ",pe("level")]}),de("th",{className:"sortable",onClick:()=>$("time"),children:["Time ",pe("time")]}),de("th",{className:"sortable",onClick:()=>$("message"),children:["Message ",pe("message")]})]})}),te("tbody",{children:Y.length===0?te("tr",{children:te("td",{colSpan:4,className:"no-data",children:u.length===0?"No recursive logs found":"No logs match current filter"})}):Y.map(c=>de("tr",{className:`table-row ${ae?.id===c.id?"selected":""}`,onClick:()=>ge(c),children:[te("td",{className:"table-script",style:{color:ve(c.scriptId)},children:c.scriptId||"unknown"}),te("td",{children:te("span",{className:"table-level",style:{color:be(c.level)},children:c.level.toUpperCase()})}),te("td",{className:"table-time",children:Z(c.time)}),te("td",{className:"table-message",children:c.message})]},c.id))})]})})]}),de("div",{className:"recursive-logs-logs-column",children:[de("div",{className:"recursive-logs-filters",children:[de("div",{className:"filter-group",children:[te("label",{children:"Script:"}),de("select",{value:P.scriptId,onChange:c=>v(oe=>({...oe,scriptId:c.target.value})),children:[te("option",{value:"",children:"All Scripts"}),ee.map(c=>de("option",{value:c,children:[c," (",G.byScript[c]||0,")"]},c))]})]}),de("div",{className:"filter-group",children:[te("label",{children:"Level:"}),de("select",{value:P.level,onChange:c=>v(oe=>({...oe,level:c.target.value})),children:[te("option",{value:"",children:"All Levels"}),Ie.map(c=>de("option",{value:c,children:[c.toUpperCase()," (",G.byLevel[c]||0,")"]},c))]})]}),de("div",{className:"filter-group",children:[te("label",{children:"Search:"}),te("input",{type:"text",placeholder:"Search in messages...",value:P.search,onChange:c=>v(oe=>({...oe,search:c.target.value}))})]}),te("button",{className:"clear-btn",onClick:()=>{v({level:"",scriptId:"",search:""}),re(null)},children:"Clear Filters"})]}),m&&de("div",{className:"error-message",children:["Error: ",m]}),te("div",{className:"recursive-logs-list",children:h.length===0?te("div",{className:"no-logs",children:u.length===0?"No recursive logs found":"No logs match current filter"}):h.map(c=>de("div",{className:`log-entry ${C.has(c.id)?"expanded":""} ${ae?.id===c.id?"selected":""}`,"data-script-id":c.scriptId,children:[de("div",{className:"log-header",onClick:()=>M(c.id),children:[te("div",{className:"log-level",style:{color:be(c.level)},children:c.level.toUpperCase()}),te("div",{className:"log-time",children:Z(c.time)}),te("div",{className:"log-script",style:{color:ve(c.scriptId)},children:c.scriptId}),te("div",{className:"log-message",children:c.message}),te("div",{className:"log-expand",children:"\u25B6"})]}),C.has(c.id)&&de("div",{className:"log-details",children:[c.data&&de("div",{className:"log-data",children:[te("strong",{children:"Data:"}),te("pre",{children:JSON.stringify(c.data,null,2)})]}),c.file&&de("div",{className:"log-file",children:[te("strong",{children:"File:"})," ",c.file,":",c.line,":",c.column,c.functionName&&` (${c.functionName})`]}),c.stack&&de("div",{className:"log-stack",children:[te("strong",{children:"Stack:"}),te("pre",{children:c.stack})]})]})]},c.id))})]})]})]})}import{useState as Ze,useEffect as jt}from"react";import{jsx as L,jsxs as he}from"react/jsx-runtime";var Ut=()=>{let[o,n]=Ze(null),[d,u]=Ze(null),[f,P]=Ze(!0),[v,C]=Ze(null),[z,X]=Ze(!1),[R,m]=Ze(null),N=async()=>{try{P(!0);let b=G(),[i,a]=await Promise.all([fetch("/api/instrumentation/config"),fetch("/api/monitoring")]);if(i.ok){let T=await i.json(),Q=b||T.config;n(Q),b&&await fetch("/api/instrumentation/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:b})})}else b?n(b):C("Failed to fetch instrumentation configuration");if(a.ok){let T=await a.json();u(T)}else console.warn("Failed to fetch monitoring data");C(null)}catch{let i=G();i?(n(i),C(null)):C("Network error while fetching data")}finally{P(!1)}},G=()=>{try{let b=localStorage.getItem("allog-save-system");if(b){let i=JSON.parse(b);if(i.activeProfile){let a=i.activeProfile,T=i.items?.find(Q=>Q.id===a);if(T){m(T);let Q=i.items?.find(M=>M.type==="profile-settings"&&M.parentId===a);if(Q?.metadata?.data?.instrumentation)return Q.metadata.data.instrumentation}}}}catch(b){console.warn("Failed to load profile instrumentation settings:",b)}return null},K=async b=>{try{X(!0),(await fetch("/api/instrumentation/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:b})})).ok?(n(b),await ae(b),C(null)):C("Failed to save instrumentation configuration")}catch{C("Network error while saving configuration")}finally{X(!1)}},ae=async b=>{try{let i=localStorage.getItem("allog-save-system");if(i){let a=JSON.parse(i);if(a.activeProfile){let T=a.activeProfile,Q=a.items?.find(M=>M.type==="profile-settings"&&M.parentId===T);Q?(Q.metadata.data.instrumentation=b,Q.metadata.updatedAt=new Date().toISOString()):(Q={id:`profile-settings-${T}`,name:"Profile Settings",type:"profile-settings",parentId:T,metadata:{description:"Settings for profile",tags:["profile","settings","system"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{theme:"dark",autoSave:!0,notifications:!0,defaultView:"logs",instrumentation:b}}},a.items=a.items||[],a.items.push(Q)),localStorage.setItem("allog-save-system",JSON.stringify(a))}}}catch(i){console.warn("Failed to save to profile:",i)}},re=async b=>{if(!o)return;let i={...o};switch(b){case"comprehensive":i.enabled=!0,i.defaultLevel="comprehensive",Object.keys(i.components).forEach(a=>{i.components[a].enabled=!0,i.components[a].level="comprehensive"}),Object.keys(i.methods).forEach(a=>{i.methods[a]=!0}),Object.keys(i.state).forEach(a=>{i.state[a]=!0}),Object.keys(i.dataFlow).forEach(a=>{i.dataFlow[a]=!0}),Object.keys(i.performance).forEach(a=>{i.performance[a]=!0});break;case"detailed":i.enabled=!0,i.defaultLevel="detailed",Object.keys(i.components).forEach(a=>{i.components[a].enabled=!0,i.components[a].level="detailed"}),i.methods.logMethodCalls=!0,i.methods.logMethodParameters=!0,i.methods.logMethodReturns=!0,i.methods.logMethodTiming=!1,i.methods.logMethodErrors=!0,i.state.logVariableChanges=!0,i.state.logConfigurationChanges=!0,i.state.logBufferOperations=!0,i.state.logModuleStateChanges=!1,i.state.logServerCommunication=!0,i.dataFlow.logDataTransformation=!0,i.dataFlow.logDataRouting=!0,i.dataFlow.logDataFiltering=!0,i.dataFlow.logDataSerialization=!1,i.performance.logExecutionTime=!0,i.performance.logMemoryUsage=!1,i.performance.logBufferStats=!0,i.performance.logServerLatency=!1;break;case"basic":i.enabled=!0,i.defaultLevel="basic",Object.keys(i.components).forEach(a=>{i.components[a].enabled=!0,i.components[a].level="basic"}),i.methods.logMethodCalls=!0,i.methods.logMethodParameters=!1,i.methods.logMethodReturns=!1,i.methods.logMethodTiming=!1,i.methods.logMethodErrors=!0,i.state.logVariableChanges=!1,i.state.logConfigurationChanges=!0,i.state.logBufferOperations=!1,i.state.logModuleStateChanges=!1,i.state.logServerCommunication=!1,i.dataFlow.logDataTransformation=!1,i.dataFlow.logDataRouting=!1,i.dataFlow.logDataFiltering=!1,i.dataFlow.logDataSerialization=!1,i.performance.logExecutionTime=!1,i.performance.logMemoryUsage=!1,i.performance.logBufferStats=!1,i.performance.logServerLatency=!1;break;case"none":i.enabled=!1,i.defaultLevel="none",Object.keys(i.components).forEach(a=>{i.components[a].enabled=!1,i.components[a].level="none"}),Object.keys(i.methods).forEach(a=>{i.methods[a]=!1}),Object.keys(i.state).forEach(a=>{i.state[a]=!1}),Object.keys(i.dataFlow).forEach(a=>{i.dataFlow[a]=!1}),Object.keys(i.performance).forEach(a=>{i.performance[a]=!1});break}await K(i)},ce=async(b,i)=>{if(!o)return;let a={...o},T=b.split("."),Q=a;for(let M=0;M<T.length-1;M++)Q=Q[T[M]];Q[T[T.length-1]]=i,await K(a)},Ne=async(b,i)=>{if(!d)return;let a={...d.modules};if(a[b]={...a[b],level:i},u({...d,modules:a}),o){let T={...o};T.components||(T.components={}),T.components[b]?T.components[b].level=i:T.components[b]={enabled:!0,level:i,methods:[],excludeMethods:[]},await K(T)}},J=async(b,i)=>{if(!d)return;let a={...d.modules};if(a[b]={...a[b],enabled:i},u({...d,modules:a}),o){let T={...o};T.components||(T.components={}),T.components[b]?T.components[b].enabled=i:T.components[b]={enabled:i,level:"detailed",methods:[],excludeMethods:[]},await K(T)}};return jt(()=>{N()},[]),f?L("div",{className:"instrumentation-page",children:L("div",{className:"loading",children:"Loading instrumentation configuration..."})}):v?L("div",{className:"instrumentation-page",children:he("div",{className:"error",children:[L("h3",{children:"Error"}),L("p",{children:v}),L("button",{onClick:N,children:"Retry"})]})}):o?he("div",{className:"instrumentation-page",children:[he("div",{className:"instrumentation-header",children:[L("h2",{children:"\u{1F527} Instrumentation Controls"}),L("p",{children:"Configure what gets logged in the Allog system"}),R&&L("div",{className:"profile-indicator",children:he("span",{className:"profile-badge",children:["\u{1F4C1} Settings auto-saved to profile: ",L("strong",{children:R.name})]})})]}),he("div",{className:"preset-section",children:[L("h3",{children:"Quick Presets"}),he("div",{className:"preset-buttons",children:[L("button",{className:"preset-btn comprehensive",onClick:()=>re("comprehensive"),disabled:z,children:"\u{1F50D} Comprehensive"}),L("button",{className:"preset-btn detailed",onClick:()=>re("detailed"),disabled:z,children:"\u{1F4CA} Detailed"}),L("button",{className:"preset-btn basic",onClick:()=>re("basic"),disabled:z,children:"\u{1F4DD} Basic"}),L("button",{className:"preset-btn none",onClick:()=>re("none"),disabled:z,children:"\u{1F6AB} None"})]})]}),he("div",{className:"config-section",children:[L("h3",{children:"Global Settings"}),he("div",{className:"config-grid",children:[L("div",{className:"config-item",children:he("label",{children:[L("input",{type:"checkbox",checked:o.enabled,onChange:b=>ce("enabled",b.target.checked),disabled:z}),"Enable Instrumentation"]})}),he("div",{className:"config-item",children:[L("label",{children:"Default Level:"}),he("select",{value:o.defaultLevel,onChange:b=>ce("defaultLevel",b.target.value),disabled:z,children:[L("option",{value:"none",children:"None"}),L("option",{value:"basic",children:"Basic"}),L("option",{value:"detailed",children:"Detailed"}),L("option",{value:"comprehensive",children:"Comprehensive"})]})]})]})]}),he("div",{className:"config-section",children:[he("h3",{children:["Active Components (",d?.stats.totalModules||0," discovered)"]}),d&&d.modules&&Object.keys(d.modules).length>0?L("div",{className:"components-table",children:he("table",{children:[L("thead",{children:he("tr",{children:[L("th",{children:"Module"}),L("th",{children:"Scripts"}),L("th",{children:"Variables"}),L("th",{children:"States"}),L("th",{children:"Functions"}),L("th",{children:"Properties"}),L("th",{children:"Events"}),L("th",{children:"Last Update"}),L("th",{children:"Level"}),L("th",{children:"Enabled"})]})}),L("tbody",{children:Object.entries(d.modules).map(([b,i])=>{let a=Object.keys(i.scripts||{}).length,T=0,Q=0,M=0,ge=0,$=0;Object.values(i.scripts||{}).forEach(se=>{T+=Object.keys(se.variables||{}).length,Q+=Object.keys(se.states||{}).length,M+=Object.keys(se.functions||{}).length,ge+=Object.keys(se.properties||{}).length,$+=Object.keys(se.events||{}).length});let pe=o.components&&o.components[b]?o.components[b]:{enabled:!0,level:o.defaultLevel||"detailed"};return he("tr",{className:"module-row",children:[he("td",{className:"module-name",children:[L("span",{className:"module-icon",children:"\u{1F4E6}"}),b]}),L("td",{className:"module-scripts",children:a}),L("td",{className:"module-variables",children:T}),L("td",{className:"module-states",children:Q}),L("td",{className:"module-functions",children:M}),L("td",{className:"module-properties",children:ge}),L("td",{className:"module-events",children:$}),L("td",{className:"module-last-update",children:i.lastUpdate?new Date(i.lastUpdate).toLocaleString():"Never"}),L("td",{className:"module-level",children:he("select",{value:pe.level,onChange:se=>Ne(b,se.target.value),disabled:z,className:"level-select",children:[L("option",{value:"none",children:"None"}),L("option",{value:"basic",children:"Basic"}),L("option",{value:"detailed",children:"Detailed"}),L("option",{value:"comprehensive",children:"Comprehensive"})]})}),L("td",{className:"module-enabled",children:L("input",{type:"checkbox",checked:pe.enabled,onChange:se=>J(b,se.target.checked),disabled:z,className:"enabled-checkbox"})})]},b)})})]})}):he("div",{className:"no-components",children:[L("p",{children:"No active components detected. Components will appear here as they send logs."}),L("button",{onClick:N,disabled:f,children:"\u{1F504} Refresh Discovery"})]})]}),he("div",{className:"config-section",children:[L("h3",{children:"Method Logging"}),L("div",{className:"config-grid",children:Object.entries(o.methods||{}).map(([b,i])=>L("div",{className:"config-item",children:he("label",{children:[L("input",{type:"checkbox",checked:i,onChange:a=>ce(`methods.${b}`,a.target.checked),disabled:z}),b.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())]})},b))})]}),he("div",{className:"config-section",children:[L("h3",{children:"State Logging"}),L("div",{className:"config-grid",children:Object.entries(o.state||{}).map(([b,i])=>L("div",{className:"config-item",children:he("label",{children:[L("input",{type:"checkbox",checked:i,onChange:a=>ce(`state.${b}`,a.target.checked),disabled:z}),b.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())]})},b))})]}),he("div",{className:"config-section",children:[L("h3",{children:"Data Flow Logging"}),L("div",{className:"config-grid",children:Object.entries(o.dataFlow||{}).map(([b,i])=>L("div",{className:"config-item",children:he("label",{children:[L("input",{type:"checkbox",checked:i,onChange:a=>ce(`dataFlow.${b}`,a.target.checked),disabled:z}),b.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())]})},b))})]}),he("div",{className:"config-section",children:[L("h3",{children:"Performance Logging"}),L("div",{className:"config-grid",children:Object.entries(o.performance||{}).map(([b,i])=>L("div",{className:"config-item",children:he("label",{children:[L("input",{type:"checkbox",checked:i,onChange:a=>ce(`performance.${b}`,a.target.checked),disabled:z}),b.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())]})},b))})]}),z&&L("div",{className:"saving-indicator",children:"Saving configuration..."})]}):L("div",{className:"instrumentation-page",children:L("div",{className:"error",children:"No configuration available"})})},wt=Ut;import{useState as we,useEffect as je,useCallback as ye,useRef as gt,forwardRef as Ht,useImperativeHandle as Vt}from"react";import{Fragment as qe,jsx as x,jsxs as H}from"react/jsx-runtime";var Bt=Ht(({isOpen:o,onToggle:n,onSave:d,onLoad:u,onDelete:f,onExport:P,onImport:v,currentData:C,currentView:z,onCreateHighlight:X},R)=>{let[m,N]=we({items:[],expandedFolders:new Set,selectedItem:null,editingItem:null,activeProfile:null}),[G,K]=we(""),[ae,re]=we("profile"),[ce,Ne]=we(!1),[J,b]=we(!1),i=gt(new Map),[a,T]=we({isVisible:!1,x:0,y:0,targetItem:null}),[Q,M]=we(null),[ge,$]=we(""),[pe,se]=we({total:0,buffer:500,modules:0,info:0,warn:0,error:0,debug:0,scripts:15,variables:30,states:45,functions:30,properties:30,events:30});je(()=>{let e=localStorage.getItem("allog-save-system");if(e)try{let p=JSON.parse(e),y=p.items||[],I=Ie(y);N(V=>({...V,items:I,expandedFolders:new Set(p.expandedFolders||[]),activeProfile:p.activeProfile||null}))}catch{h()}else h()},[]);let h=ye(()=>{let e=[{id:"default-profile",name:"Default Profile",type:"profile",metadata:{description:"Default profile for all saves",tags:["default"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-highlight",name:"Highlights",type:"highlight",parentId:"default-profile",metadata:{description:"Default highlight category",tags:["default","highlight"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-comparison",name:"Comparisons",type:"comparison",parentId:"default-profile",metadata:{description:"Default comparison category",tags:["default","comparison"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-filter-preset",name:"Filter Presets",type:"filter-preset",parentId:"default-profile",metadata:{description:"Default filter presets category",tags:["default","filter"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-view-preset",name:"View Presets",type:"view-preset",parentId:"default-profile",metadata:{description:"Default view presets category",tags:["default","view"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-log-session",name:"Log Sessions",type:"log-session",parentId:"default-profile",metadata:{description:"Default log sessions category",tags:["default","log"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},{id:"default-monitoring-session",name:"Monitoring Sessions",type:"monitoring-session",parentId:"default-profile",metadata:{description:"Default monitoring sessions category",tags:["default","monitoring"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}];N(p=>({...p,items:e,expandedFolders:new Set(["default-profile"])}))},[]),Y=ye(e=>{if(!e)return null;if(e.type==="profile")return e;if(e.parentId){let p=m.items.find(y=>y.id===e.parentId);if(p)return p.type==="profile"?p:Y(p)}return null},[m.items]),ee=ye((e,p)=>{let y=new Date().toISOString(),I=e.replace("profile-","");return[{id:`${I}-highlight`,name:"Highlights",type:"highlight",parentId:e,metadata:{description:`${p} highlight category`,tags:[p.toLowerCase(),"highlight"],createdAt:y,updatedAt:y}},{id:`${I}-comparison`,name:"Comparisons",type:"comparison",parentId:e,metadata:{description:`${p} comparison category`,tags:[p.toLowerCase(),"comparison"],createdAt:y,updatedAt:y}},{id:`${I}-filter-preset`,name:"Filter Presets",type:"filter-preset",parentId:e,metadata:{description:`${p} filter presets category`,tags:[p.toLowerCase(),"filter"],createdAt:y,updatedAt:y}},{id:`${I}-view-preset`,name:"View Presets",type:"view-preset",parentId:e,metadata:{description:`${p} view presets category`,tags:[p.toLowerCase(),"view"],createdAt:y,updatedAt:y}},{id:`${I}-log-session`,name:"Log Sessions",type:"log-session",parentId:e,metadata:{description:`${p} log sessions category`,tags:[p.toLowerCase(),"log"],createdAt:y,updatedAt:y}},{id:`${I}-monitoring-session`,name:"Monitoring Sessions",type:"monitoring-session",parentId:e,metadata:{description:`${p} monitoring sessions category`,tags:[p.toLowerCase(),"monitoring"],createdAt:y,updatedAt:y}}]},[]),Ie=ye(e=>{console.log("SaveSystem: Ensuring default structure exists...");let p=e.some(Ce=>Ce.id==="default-profile"),y=e.some(Ce=>Ce.id==="default-highlight"),I=e.some(Ce=>Ce.id==="default-comparison"),V=e.some(Ce=>Ce.id==="default-filter-preset"),q=e.some(Ce=>Ce.id==="default-view-preset"),Se=e.some(Ce=>Ce.id==="default-log-session"),U=e.some(Ce=>Ce.id==="default-monitoring-session"),ke=[];return p||ke.push({id:"default-profile",name:"Default Profile",type:"profile",metadata:{description:"Default profile for all saves",tags:["default"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),y||ke.push({id:"default-highlight",name:"Highlights",type:"highlight",parentId:"default-profile",metadata:{description:"Default highlight category",tags:["default","highlight"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),I||ke.push({id:"default-comparison",name:"Comparisons",type:"comparison",parentId:"default-profile",metadata:{description:"Default comparison category",tags:["default","comparison"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),V||ke.push({id:"default-filter-preset",name:"Filter Presets",type:"filter-preset",parentId:"default-profile",metadata:{description:"Default filter presets category",tags:["default","filter"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),q||ke.push({id:"default-view-preset",name:"View Presets",type:"view-preset",parentId:"default-profile",metadata:{description:"Default view presets category",tags:["default","view"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),Se||ke.push({id:"default-log-session",name:"Log Sessions",type:"log-session",parentId:"default-profile",metadata:{description:"Default log sessions category",tags:["default","log"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),U||ke.push({id:"default-monitoring-session",name:"Monitoring Sessions",type:"monitoring-session",parentId:"default-profile",metadata:{description:"Default monitoring sessions category",tags:["default","monitoring"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),ke.length>0?(console.log("SaveSystem: Adding missing default items:",ke),[...e,...ke]):e},[]);je(()=>{console.log("SaveSystem: Saving state to localStorage:",{items:m.items,expandedFolders:Array.from(m.expandedFolders),activeProfile:m.activeProfile}),localStorage.setItem("allog-save-system",JSON.stringify({items:m.items,expandedFolders:Array.from(m.expandedFolders),activeProfile:m.activeProfile}))},[m.items,m.expandedFolders,m.activeProfile]),je(()=>{let e=()=>{T(p=>({...p,isVisible:!1}))};if(a.isVisible)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[a.isVisible]);let be=ye(()=>{if(console.log("SaveSystem: Creating new item:",{newItemName:G,newItemType:ae,selectedItem:m.selectedItem}),!G.trim())return;let e=ae==="profile"||ae==="highlight"||ae==="comparison"||ae==="filter-preset"||ae==="view-preset"||ae==="log-session"||ae==="monitoring-session",p=ae.includes("-")&&ae!=="filter-preset"&&ae!=="view-preset"&&ae!=="log-session"&&ae!=="monitoring-session";if(e){let y;if(ae==="profile")y=void 0;else{let V=Y(m.selectedItem);if(!V){console.warn("\u274C Please select a profile or a subfolder within a profile to create this item.");return}y=V.id}let I={id:`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:G.trim(),type:ae,parentId:y,metadata:{description:"",tags:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};console.log("SaveSystem: Creating new folder:",I),N(V=>{let q=[...V.items,I];if(ae==="profile"){let U=ee(I.id,I.name);q=[...q,...U],console.log("SaveSystem: Created default folders for new profile:",U)}let Se={...V,items:q};return ae==="profile"&&(Se.expandedFolders=new Set(Array.from(V.expandedFolders).concat(I.id))),console.log("SaveSystem: New state after creating folder:",Se),Se})}else if(p){if(!m.selectedItem||m.selectedItem.type!=="highlight"&&m.selectedItem.type!=="comparison"&&m.selectedItem.type!=="filter-preset"&&m.selectedItem.type!=="view-preset"&&m.selectedItem.type!=="log-session"&&m.selectedItem.type!=="monitoring-session"){console.warn("\u274C Please select a category (highlight, comparison, etc.) first to create a save node.");return}let y={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:G.trim(),type:ae,parentId:m.selectedItem.id,metadata:{description:"",tags:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:C,target:G.trim()}};console.log("SaveSystem: Creating new node:",y),N(I=>{let V={...I,items:[...I.items,y]};return console.log("SaveSystem: New state after creating node:",V),V})}K(""),re("profile"),Ne(!1)},[G,ae,m.selectedItem,C,ee,Y]),ve=ye(e=>{N(p=>{let y=new Set(p.expandedFolders);return y.has(e)?y.delete(e):y.add(e),{...p,expandedFolders:y}})},[]),Z=ye(e=>{let p=Y(e);N(y=>({...y,selectedItem:e,activeProfile:p})),e.type==="profile"?re("highlight"):e.type==="highlight"?re("highlight-script"):e.type==="comparison"&&re("comparison")},[Y]),c=ye(e=>{N(p=>({...p,editingItem:e})),b(!0)},[]),oe=ye(e=>{let p=m.items.find(q=>q.id===e),y=p?.type==="profile"||p?.type==="profile-settings",I=p?.type?.startsWith("highlight-");if(y&&!window.confirm("Are you sure you want to delete this profile?"))return;let V=[e];if(p?.type==="profile"){let q=m.items.find(Se=>Se.type==="profile-settings"&&Se.parentId===e);q&&V.push(q.id)}if(N(q=>({...q,items:q.items.filter(Se=>!V.includes(Se.id)),selectedItem:q.selectedItem&&!V.includes(q.selectedItem.id)?q.selectedItem:null,editingItem:q.editingItem&&!V.includes(q.editingItem.id)?q.editingItem:null,activeProfile:q.activeProfile&&!V.includes(q.activeProfile.id)?q.activeProfile:null})),V.forEach(q=>f(q)),I){let q=new CustomEvent("highlight-updated",{detail:{highlightId:e,deleted:!0}});window.dispatchEvent(q)}},[f,m.items]),Ae=ye(e=>{let p={...e,id:`${e.type}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`${e.name} (Copy)`,metadata:{...e.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};N(y=>({...y,items:[...y.items,p]}))},[]),xe=ye(e=>{M(e),$(e.name)},[]),Me=ye(()=>{Q&&ge.trim()&&N(e=>({...e,items:e.items.map(p=>p.id===Q.id?{...p,name:ge.trim()}:p),selectedItem:e.selectedItem?.id===Q.id?{...e.selectedItem,name:ge.trim()}:e.selectedItem})),M(null),$("")},[Q,ge]),ze=ye(()=>{M(null),$("")},[]),Ee=ye((e,p)=>{let y=`save-item-${p.id}`,I=Date.now(),V=i.current.get(y);if(console.log("SaveSystem: Right-click detected on item:",p.name,"elementId:",y,"target:",e.target,"currentTarget:",e.currentTarget),V&&I-V.lastClick<300){V.timeout&&clearTimeout(V.timeout),i.current.delete(y),console.log("SaveSystem: Double right-click detected - allowing native context menu");return}V?.timeout&&clearTimeout(V.timeout);let q=setTimeout(()=>{i.current.delete(y)},300);i.current.set(y,{lastClick:I,timeout:q}),e.preventDefault(),e.stopPropagation();let Se=Y(p);N(U=>({...U,selectedItem:p,activeProfile:Se})),T({isVisible:!0,x:e.clientX,y:e.clientY,targetItem:p,targetElement:e.currentTarget})},[Z]),Ue=ye(e=>{let p="tree-container",y=Date.now(),I=i.current.get(p);if(console.log("SaveSystem: Right-click detected on tree container, target:",e.target,"currentTarget:",e.currentTarget),I&&y-I.lastClick<300){I.timeout&&clearTimeout(I.timeout),i.current.delete(p),console.log("SaveSystem: Double right-click detected - allowing native context menu");return}I?.timeout&&clearTimeout(I.timeout);let V=setTimeout(()=>{i.current.delete(p)},300);i.current.set(p,{lastClick:y,timeout:V}),e.preventDefault(),e.stopPropagation(),e.target===e.currentTarget&&T({isVisible:!0,x:e.clientX,y:e.clientY,targetItem:null,targetElement:e.currentTarget})},[]),Qe=ye(e=>{switch(e){case"profile":return["last-ui"];case"highlight":return["highlight-script","highlight-module","highlight-method","highlight-value"];case"comparison":return["comparison"];case"filter-preset":case"view-preset":case"log-session":case"monitoring-session":return["last-ui"];default:return[]}},[]),_e=ye((e,p)=>{let y=`New ${p.replace("-"," ").replace(/\b\w/g,q=>q.toUpperCase())}`,I={id:`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:y,type:p,parentId:e.id,metadata:{description:`Auto-generated ${p} node`,tags:["auto-generated",p],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{},highlightData:p.startsWith("highlight-")?{color:"#ff0000",pattern:"default"}:void 0,comparisonData:p==="comparison"?{operation:"equals",leftOperand:"",rightOperand:"",isValid:!1}:void 0}};N(q=>({...q,items:[...q.items,I],selectedItem:I}));let V={items:[...m.items,I],expandedFolders:Array.from(m.expandedFolders)};localStorage.setItem("allog-save-system",JSON.stringify(V))},[m.items,m.expandedFolders]),et=ye(e=>{let p=m.items.find(U=>U.type==="highlight"&&U.parentId==="default-profile");p||(p={id:"default-highlight",name:"Highlights",type:"highlight",parentId:"default-profile",metadata:{description:"Default highlight category",tags:["default","highlight"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},N(U=>({...U,items:[...U.items,p]})));let y="highlight-value";e.scriptId&&e.moduleId?y="highlight-script":e.moduleId&&(y="highlight-module");let I=e.name;if(e.data){if(e.data.type&&e.data.name&&e.moduleId&&e.scriptId){let U=e.moduleId.split("/"),ke=U[U.length-1],Ce=e.scriptId.split("/"),tt=Ce[Ce.length-1];I=`.[${ke}/${tt}]-${e.data.name}`}else if(e.data.message&&e.scriptId){let U=e.scriptId.split("/"),ke=U[U.length-1],Ce=e.data.message,tt=Ce.length>30?Ce.substring(0,30).replace(/\s+\w*$/,"")+"...":Ce;I=`.[${ke}]-${tt}`}}let V={id:`highlight-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:I,type:y,parentId:p.id,metadata:{description:e.description,tags:e.tags,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:e.data,target:e.data?.name||e.data?.message||e.name,highlightData:{scriptId:e.scriptId,moduleId:e.moduleId,color:"#ffff00",pattern:"default"}}};N(U=>({...U,items:[...U.items,V],selectedItem:V}));let q={items:[...m.items,V],expandedFolders:Array.from(m.expandedFolders)};localStorage.setItem("allog-save-system",JSON.stringify(q)),X&&X(e);let Se=new CustomEvent("highlight-updated",{detail:{highlightId:V.id,created:!0}});return window.dispatchEvent(Se),V},[m.items,m.expandedFolders,X]),l=ye(e=>{let p=m.items.find(y=>{if(y.type?.startsWith("highlight-")&&y.metadata?.highlightData){let I=y.metadata.highlightData;if(I.scriptId&&e.scriptId&&!e.scriptId.includes(I.scriptId)||I.moduleId&&e.moduleId&&!e.moduleId.includes(I.moduleId)||I.valueId&&e.name&&!e.name.includes(I.valueId))return!1;if(e.elementType==="log"&&y.metadata?.target&&e.logMessage)return e.logMessage.toLowerCase().includes(y.metadata.target.toLowerCase());if(e.name&&y.metadata?.target)return e.name.toLowerCase().includes(y.metadata.target.toLowerCase());if(y.metadata?.target){if(e.elementType==="log"&&e.logMessage)return e.logMessage.toLowerCase().includes(y.metadata.target.toLowerCase());if(e.name)return e.name.toLowerCase().includes(y.metadata.target.toLowerCase())}return!1}return!1});if(p){N(q=>({...q,items:q.items.filter(Se=>Se.id!==p.id)}));let I={items:m.items.filter(q=>q.id!==p.id),expandedFolders:Array.from(m.expandedFolders)};localStorage.setItem("allog-save-system",JSON.stringify(I));let V=new CustomEvent("highlight-updated",{detail:{highlightId:p.id,removed:!0}});return window.dispatchEvent(V),!0}return!1},[m.items,m.expandedFolders]);Vt(R,()=>({createHighlightFromData:et,removeHighlightForElement:l}),[et,l]);let s=ye((e,p)=>({id:`profile-settings-${e}`,name:"Profile Settings",type:"profile-settings",parentId:e,metadata:{description:`Settings for ${p}`,tags:["profile","settings","system"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{theme:"dark",autoSave:!0,notifications:!0,defaultView:"logs",instrumentation:{enabled:!0,defaultLevel:"detailed",components:{},methods:{logMethodCalls:!0,logMethodParameters:!0,logMethodReturns:!0,logMethodTiming:!0,logMethodErrors:!0},state:{logVariableChanges:!0,logConfigurationChanges:!0,logBufferOperations:!0,logModuleStateChanges:!0,logServerCommunication:!0},dataFlow:{logDataTransformation:!0,logDataRouting:!0,logDataFiltering:!0,logDataSerialization:!0},performance:{logExecutionTime:!0,logMemoryUsage:!0,logBufferStats:!0,logServerLatency:!0}}}}}),[]),O=ye(()=>{let e=`New Profile ${m.items.filter(V=>V.type==="profile").length+1}`,p={id:`profile-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:e,type:"profile",metadata:{description:"New profile",tags:["new","profile"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},y=s(p.id,p.name);console.log("SaveSystem: Creating new profile:",p),N(V=>{let q=[...V.items,p,y],Se=ee(p.id,p.name);q=[...q,...Se],console.log("SaveSystem: Created default folders for new profile:",Se);let U={...V,items:q,selectedItem:p,expandedFolders:new Set(Array.from(V.expandedFolders).concat(p.id))};return console.log("SaveSystem: New state after creating profile:",U),U});let I={items:[...m.items,p,y,...ee(p.id,p.name)],expandedFolders:Array.from(m.expandedFolders).concat(p.id)};localStorage.setItem("allog-save-system",JSON.stringify(I))},[m.items,m.expandedFolders,ee,s]),k=ye((e,p)=>{switch(e){case"create-profile":O();break;case"open":a.targetItem&&u(a.targetItem);break;case"edit":a.targetItem&&c(a.targetItem);break;case"rename":a.targetItem&&xe(a.targetItem);break;case"duplicate":a.targetItem&&Ae(a.targetItem);break;case"delete":a.targetItem&&oe(a.targetItem.id);break;case"properties":if(a.targetItem&&a.targetItem.type==="profile"){let y=m.items.find(I=>I.type==="profile-settings"&&I.parentId===a.targetItem.id);if(y)c(y);else{let I=s(a.targetItem.id,a.targetItem.name);N(V=>({...V,items:[...V.items,I]})),c(I)}}break;case"create-node":p&&a.targetItem&&_e(a.targetItem,p);break}T(y=>({...y,isVisible:!1}))},[a.targetItem,a.targetElement,O,u,c,xe,Ae,oe,_e]),F=m.items,_=(e,p)=>e.filter(I=>I.parentId===p&&I.type!=="profile-settings").map(I=>{if(I.type==="profile"||I.type==="highlight"||I.type==="comparison"||I.type==="filter-preset"||I.type==="view-preset"||I.type==="log-session"||I.type==="monitoring-session"){let q=_(e,I.id);return{...I,children:q}}return I}),ue=_(F),Ge=e=>{if(e.type==="profile"||e.type==="highlight"||e.type==="comparison"||e.type==="filter-preset"||e.type==="view-preset"||e.type==="log-session"||e.type==="monitoring-session")switch(e.type){case"profile":return"\u{1F464}";case"highlight":return"\u{1F50D}";case"comparison":return"\u2696\uFE0F";case"filter-preset":return"\u{1F527}";case"view-preset":return"\u{1F441}\uFE0F";case"log-session":return"\u{1F4CB}";case"monitoring-session":return"\u{1F4CA}";default:return"\u{1F4C1}"}else switch(e.type){case"profile-settings":return"\u2699\uFE0F";case"last-ui":return"\u{1F5A5}\uFE0F";case"highlight-script":return"\u{1F4DC}";case"highlight-module":return"\u{1F4E6}";case"highlight-method":return"\u{1F527}";case"highlight-value":return"\u{1F48E}";case"comparison":return"\u2696\uFE0F";default:return"\u{1F4C4}"}},me=e=>e.type==="profile"||e.type==="highlight"||e.type==="comparison"||e.type==="filter-preset"||e.type==="view-preset"||e.type==="log-session"||e.type==="monitoring-session"?`\\${e.name}`:`.${e.name}`,De=(e,p=0)=>{let y=m.expandedFolders.has(e.id),I=m.selectedItem?.id===e.id,V=e.type==="profile"||e.type==="highlight"||e.type==="comparison"||e.type==="filter-preset"||e.type==="view-preset"||e.type==="log-session"||e.type==="monitoring-session",q=V&&"children"in e&&e.children&&e.children.length>0,Se=Q?.id===e.id;return H("div",{className:"tree-item-container",onContextMenu:U=>Ee(U,e),children:[H("div",{className:`tree-item ${I?"selected":""}`,style:{paddingLeft:`${p*20+10}px`},onClick:()=>Z(e),onContextMenu:U=>Ee(U,e),children:[H("div",{className:"tree-item-content",onContextMenu:U=>Ee(U,e),children:[V&&x("span",{className:"expand-icon",onClick:U=>{U.stopPropagation(),ve(e.id)},onContextMenu:U=>Ee(U,e),children:y?"\u25BC":"\u25B6"}),x("span",{className:"item-icon",onContextMenu:U=>Ee(U,e),children:Ge(e)}),Se?x("input",{type:"text",value:ge,onChange:U=>$(U.target.value),onBlur:Me,onKeyDown:U=>{U.key==="Enter"?Me():U.key==="Escape"&&ze()},className:"rename-input",autoFocus:!0}):x("span",{className:"item-name",onContextMenu:U=>Ee(U,e),children:me(e)})]}),I&&!Se&&H("div",{className:"item-actions",onContextMenu:U=>Ee(U,e),children:[e.parentId&&(e.type==="highlight"||e.type==="comparison"||e.type==="filter-preset"||e.type==="view-preset"||e.type==="log-session"||e.type==="monitoring-session")||e.type==="profile-settings"?null:x("button",{className:"action-btn",onClick:ke=>{ke.stopPropagation(),c(e)},onContextMenu:ke=>Ee(ke,e),title:"Edit",children:"\u270F\uFE0F"}),x("button",{className:"action-btn",onClick:U=>{U.stopPropagation(),u(e)},onContextMenu:U=>Ee(U,e),title:"Load",children:"\u{1F4C2}"}),x("button",{className:"action-btn",onClick:U=>{U.stopPropagation(),P(e)},onContextMenu:U=>Ee(U,e),title:"Export",children:"\u{1F4E4}"}),e.parentId&&(e.type==="highlight"||e.type==="comparison"||e.type==="filter-preset"||e.type==="view-preset"||e.type==="log-session"||e.type==="monitoring-session")||e.type==="profile-settings"?null:x("button",{className:"action-btn",onClick:ke=>{ke.stopPropagation(),oe(e.id)},onContextMenu:ke=>Ee(ke,e),title:"Delete",children:"\u{1F5D1}\uFE0F"})]})]}),V&&y&&x("div",{className:"tree-children",children:q?e.children.map(U=>De(U,p+1)):x("div",{className:"empty-folder",style:{paddingLeft:`${(p+1)*20+10}px`,color:"#666",fontStyle:"italic"},children:"Empty folder"})})]},e.id)};return H("div",{className:`save-system ${o?"open":""}`,children:[o&&H("div",{className:"save-system-content",children:[H("div",{className:"new-item-section",children:[x("button",{className:"new-item-btn",onClick:()=>Ne(!ce),children:ce?"Cancel":"+ New Save"}),x("button",{className:"import-btn",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.style.display="none",e.onchange=p=>{let y=p.target.files?.[0];y&&v(y),document.body.removeChild(e)},document.body.appendChild(e),e.click()},title:"Import JSON file",children:"\u{1F4E5} Import"}),ce&&H("div",{className:"new-item-form",children:[x("input",{type:"text",placeholder:"Save name...",value:G,onChange:e=>K(e.target.value),className:"new-item-input"}),x("select",{value:ae,onChange:e=>re(e.target.value),className:"new-item-type-select",children:H("optgroup",{label:"Nodes",children:[m.selectedItem?.type==="profile"&&H(qe,{children:[x("option",{value:"profile-settings",children:"Profile Settings"}),x("option",{value:"last-ui",children:"Last UI"})]}),m.selectedItem?.type==="highlight"&&H(qe,{children:[x("option",{value:"highlight-script",children:"Highlight Script"}),x("option",{value:"highlight-module",children:"Highlight Module"}),x("option",{value:"highlight-method",children:"Highlight Method"}),x("option",{value:"highlight-value",children:"Highlight Value"})]}),m.selectedItem?.type==="comparison"&&x("option",{value:"comparison",children:"Comparison"}),(m.selectedItem?.type==="filter-preset"||m.selectedItem?.type==="view-preset"||m.selectedItem?.type==="log-session"||m.selectedItem?.type==="monitoring-session")&&H(qe,{children:[x("option",{value:"profile-settings",children:"Profile Settings"}),x("option",{value:"last-ui",children:"Last UI"})]})]})}),x("button",{className:"create-btn",onClick:be,disabled:!G.trim(),children:"Create"})]})]}),x("div",{className:"tree-container",onContextMenu:Ue,children:ue.length===0?H("div",{className:"empty-state",children:[x("p",{children:"No saves found"}),x("p",{children:"Create your first save to get started"})]}):ue.map(e=>De(e))}),m.selectedItem&&H("div",{className:"selected-item-details",children:[x("h4",{children:me(m.selectedItem)}),x("p",{className:"item-type",children:m.selectedItem.type}),m.selectedItem.metadata?.description&&x("p",{className:"item-description",children:m.selectedItem.metadata.description}),H("div",{className:"item-metadata",children:[H("span",{children:["Created: ",new Date(m.selectedItem.metadata?.createdAt||"").toLocaleDateString()]}),H("span",{children:["Updated: ",new Date(m.selectedItem.metadata?.updatedAt||"").toLocaleDateString()]})]}),m.activeProfile&&m.activeProfile.id!==m.selectedItem.id&&H("div",{className:"active-profile-indicator",children:[x("span",{className:"active-profile-label",children:"Active Profile:"}),x("span",{className:"active-profile-name",children:me(m.activeProfile)})]})]})]}),x(Jt,{item:m.editingItem,isOpen:J,onClose:()=>{b(!1),N(e=>({...e,editingItem:null}))},onSave:e=>{N(p=>({...p,items:p.items.map(y=>y.id===e.id?e:y),editingItem:null})),b(!1)},items:m.items}),a.isVisible&&x("div",{className:"context-menu",style:{left:a.x,top:a.y},onClick:e=>e.stopPropagation(),children:a.targetItem?H(qe,{children:[H("div",{className:"context-menu-item",onClick:()=>k("open"),children:[x("span",{className:"context-menu-icon",children:"\u{1F4C2}"}),"Open"]}),a.targetItem.parentId&&(a.targetItem.type==="highlight"||a.targetItem.type==="comparison"||a.targetItem.type==="filter-preset"||a.targetItem.type==="view-preset"||a.targetItem.type==="log-session"||a.targetItem.type==="monitoring-session")||a.targetItem.type==="profile-settings"?null:H("div",{className:"context-menu-item",onClick:()=>k("edit"),children:[x("span",{className:"context-menu-icon",children:"\u270F\uFE0F"}),"Edit"]}),a.targetItem.parentId&&(a.targetItem.type==="highlight"||a.targetItem.type==="comparison"||a.targetItem.type==="filter-preset"||a.targetItem.type==="view-preset"||a.targetItem.type==="log-session"||a.targetItem.type==="monitoring-session")||a.targetItem.type==="profile-settings"?null:H(qe,{children:[x("div",{className:"context-menu-separator"}),H("div",{className:"context-menu-item",onClick:()=>k("rename"),children:[x("span",{className:"context-menu-icon",children:"\u270F\uFE0F"}),"Rename"]})]}),a.targetItem.parentId&&(a.targetItem.type==="highlight"||a.targetItem.type==="comparison"||a.targetItem.type==="filter-preset"||a.targetItem.type==="view-preset"||a.targetItem.type==="log-session"||a.targetItem.type==="monitoring-session")||a.targetItem.type==="profile-settings"?null:H("div",{className:"context-menu-item",onClick:()=>k("duplicate"),children:[x("span",{className:"context-menu-icon",children:"\u{1F4CB}"}),"Duplicate"]}),a.targetItem.type!=="profile"&&a.targetItem.type!=="profile-settings"&&a.targetItem.type!=="last-ui"&&a.targetItem.type!=="highlight-script"&&a.targetItem.type!=="highlight-module"&&a.targetItem.type!=="highlight-method"&&a.targetItem.type!=="highlight-value"&&a.targetItem.type!=="comparison"&&H(qe,{children:[x("div",{className:"context-menu-separator"}),Qe(a.targetItem.type).map(e=>H("div",{className:"context-menu-item",onClick:()=>k("create-node",e),children:[x("span",{className:"context-menu-icon",children:e==="profile-settings"?"\u2699\uFE0F":e==="last-ui"?"\u{1F5A5}\uFE0F":e==="highlight-script"?"\u{1F4DC}":e==="highlight-module"?"\u{1F4E6}":e==="highlight-method"?"\u{1F527}":e==="highlight-value"?"\u{1F48E}":e==="comparison"?"\u2696\uFE0F":"\u{1F4C4}"}),"Create ",e.replace("-"," ").replace(/\b\w/g,p=>p.toUpperCase())]},e))]}),x("div",{className:"context-menu-separator"}),H("div",{className:"context-menu-item",onClick:()=>k("properties"),children:[x("span",{className:"context-menu-icon",children:"\u2139\uFE0F"}),"Properties"]}),a.targetItem.parentId&&(a.targetItem.type==="highlight"||a.targetItem.type==="comparison"||a.targetItem.type==="filter-preset"||a.targetItem.type==="view-preset"||a.targetItem.type==="log-session"||a.targetItem.type==="monitoring-session")||a.targetItem.type==="profile-settings"?null:H(qe,{children:[x("div",{className:"context-menu-separator"}),H("div",{className:"context-menu-item context-menu-item-danger",onClick:()=>k("delete"),children:[x("span",{className:"context-menu-icon",children:"\u{1F5D1}\uFE0F"}),"Delete"]})]})]}):x(qe,{children:H("div",{className:"context-menu-item",onClick:()=>k("create-profile"),children:[x("span",{className:"context-menu-icon",children:"\u{1F464}"}),"Create New Profile"]})})})]})}),Jt=({item:o,isOpen:n,onClose:d,onSave:u,items:f})=>{let[P,v]=we(o),[C,z]=we(o?.metadata?.description||""),[X,R]=we(o?.metadata?.tags?.join(", ")||""),[m,N]=we(!1),[G,K]=we(!1),[ae,re]=we(o?.name||""),ce=gt(null);je(()=>{o&&(v(o),z(o.metadata?.description||""),R(o.metadata?.tags?.join(", ")||""),re(o.name))},[o]);let Ne=ye($=>{if(!$)return null;if($.type==="profile")return $;if($.parentId){let pe=f.find(se=>se.id===$.parentId);if(pe)return pe.type==="profile"?pe:Ne(pe)}return null},[f]),J=Ne(o),b=gt(null);if(je(()=>{G&&ce.current&&(ce.current.focus(),ce.current.select())},[G]),je(()=>{o&&re(o.name)},[o]),je(()=>{if(!n||!b.current||!o)return;let $=()=>{if(!b.current)return;let ee=document.querySelector(".save-system"),Ie=document.querySelector(".monitoring-detail"),be=window.innerWidth<=768,ve=ee?.classList.contains("open")?be?280:300:0,Z=0;if(Ie){let Ae=window.getComputedStyle(Ie),xe=Ie.getBoundingClientRect();Ae.display!=="none"&&Ae.visibility!=="hidden"&&Ae.opacity!=="0"&&xe.width>0&&xe.height>0&&(Z=xe.width>0?xe.width:be?320:400)}let c=ve,oe=`calc(100vw - ${ve}px - ${Z}px)`;b.current.style.setProperty("--save-editor-left",`${c}px`),b.current.style.setProperty("--save-editor-width",oe),console.log("SaveEditor positioning:",{saveSystemWidth:ve,monitoringDetailWidth:Z,left:c,width:oe,isMobile:be,monitoringDetailExists:!!Ie,monitoringDetailStyle:Ie?window.getComputedStyle(Ie).display:"N/A"})};$();let pe=new MutationObserver($);pe.observe(document.body,{attributes:!0,attributeFilter:["class","style"],subtree:!0});let se=ee=>{ee.target===b.current&&N(!0)},h=ee=>{if(!m||!b.current)return;let Ie=b.current.getBoundingClientRect(),be=window.innerHeight-ee.clientY,ve=300,Z=window.innerHeight*.8;be>=ve&&be<=Z&&(b.current.style.height=`${be}px`)},Y=()=>{N(!1)};return m&&(document.addEventListener("mousemove",h),document.addEventListener("mouseup",Y)),window.addEventListener("resize",$),()=>{pe.disconnect(),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",Y),window.removeEventListener("resize",$)}},[n,m,o]),!o)return null;let i=()=>{K(!0),re(o.name)},a=$=>{re($.target.value)},T=$=>{$.key==="Enter"?M():$.key==="Escape"&&(K(!1),re(o.name))},Q=()=>{M()},M=()=>{if(ae.trim()&&ae!==o.name&&P){let $={...P,name:ae.trim(),metadata:{...P.metadata,createdAt:P.metadata?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}};v($),u($)}K(!1)},ge=()=>{if(!P)return;let $={...P,metadata:{...P.metadata,description:C,tags:X.split(",").map(pe=>pe.trim()).filter(pe=>pe),createdAt:P.metadata?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}};if(u($),$.type?.startsWith("highlight-")){let pe=new CustomEvent("highlight-updated",{detail:{highlightId:$.id,updated:!0}});window.dispatchEvent(pe)}};return H("div",{className:`save-editor ${n?"open":""}`,ref:b,children:[H("div",{className:"save-editor-header",onMouseDown:$=>{($.target===$.currentTarget||$.target===$.currentTarget.querySelector("h3")||$.target===$.currentTarget.querySelector("input"))&&N(!0)},children:[H("h3",{children:["Edit"," ",G?x("input",{ref:ce,type:"text",value:ae,onChange:a,onKeyDown:T,onBlur:Q,className:"title-edit-input",autoFocus:!0}):x("span",{className:"editable-title",onClick:i,title:"Click to edit title",children:o.name}),J&&J.id!==o.id&&H("span",{className:"parent-profile-name",children:[" ","\u2022 ",J.name]})]}),x("button",{className:"close-btn",onClick:d,children:"\u2715"})]}),H("div",{className:"save-editor-content",children:[H("div",{className:"editor-section",children:[x("label",{children:"Description:"}),x("textarea",{value:C,onChange:$=>z($.target.value),placeholder:"Enter description...",rows:3})]}),H("div",{className:"editor-section",children:[x("label",{children:"Tags:"}),x("input",{type:"text",value:X,onChange:$=>R($.target.value),placeholder:"Enter tags separated by commas..."})]}),!("children"in o)&&o.type==="comparison"&&x(qt,{item:o,onUpdate:$=>v($)}),!("children"in o)&&o.type.startsWith("highlight-")&&x(Wt,{item:o,onUpdate:$=>v($)}),!("children"in o)&&o.type==="profile-settings"&&x(Yt,{item:o,onUpdate:$=>v($)}),H("div",{className:"editor-actions",children:[x("button",{className:"save-btn",onClick:ge,children:"Save"}),x("button",{className:"cancel-btn",onClick:d,children:"Cancel"})]})]})]})},qt=({item:o,onUpdate:n})=>{let[d,u]=we(o.metadata?.comparisonData?.operation||""),[f,P]=we(JSON.stringify(o.metadata?.comparisonData?.leftOperand||"")),[v,C]=we(JSON.stringify(o.metadata?.comparisonData?.rightOperand||"")),z=ye(()=>{try{let X={...o,metadata:{...o.metadata,createdAt:o.metadata?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),comparisonData:{operation:d,leftOperand:JSON.parse(f),rightOperand:JSON.parse(v),isValid:!0,result:null}}};n(X)}catch(X){console.error("Invalid JSON in comparison operands:",X)}},[o,d,f,v,n]);return je(()=>{z()},[d,f,v,z]),H("div",{className:"editor-section",children:[x("h4",{children:"Comparison Settings"}),H("div",{className:"comparison-inputs",children:[H("div",{children:[x("label",{children:"Operation:"}),H("select",{value:d,onChange:X=>u(X.target.value),children:[x("option",{value:"",children:"Select operation..."}),x("option",{value:"equals",children:"Equals"}),x("option",{value:"not-equals",children:"Not Equals"}),x("option",{value:"greater-than",children:"Greater Than"}),x("option",{value:"less-than",children:"Less Than"}),x("option",{value:"contains",children:"Contains"}),x("option",{value:"matches",children:"Matches Pattern"})]})]}),H("div",{children:[x("label",{children:"Left Operand:"}),x("textarea",{value:f,onChange:X=>P(X.target.value),placeholder:"Enter left operand...",rows:2})]}),H("div",{children:[x("label",{children:"Right Operand:"}),x("textarea",{value:v,onChange:X=>C(X.target.value),placeholder:"Enter right operand...",rows:2})]})]})]})},Wt=({item:o,onUpdate:n})=>{let[d,u]=we(o.metadata?.highlightData?.color||"#ffff00"),[f,P]=we(o.metadata?.highlightData?.pattern||""),v=ye(()=>{let C={...o,metadata:{...o.metadata,createdAt:o.metadata?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),highlightData:{...o.metadata?.highlightData,color:d,pattern:f}}};n(C)},[o,d,f,n]);return je(()=>{v()},[d,f,v]),je(()=>{let C=new CustomEvent("highlight-updated",{detail:{highlightId:o.id,color:d,pattern:f}});window.dispatchEvent(C)},[d,f,o.id]),H("div",{className:"editor-section",children:[x("h4",{children:"Highlight Settings"}),H("div",{className:"highlight-inputs",children:[H("div",{children:[x("label",{children:"Color:"}),x("input",{type:"color",value:d,onChange:C=>u(C.target.value)})]}),H("div",{children:[x("label",{children:"Pattern:"}),x("input",{type:"text",value:f,onChange:C=>P(C.target.value),placeholder:"Enter highlight pattern..."})]})]})]})},Yt=({item:o,onUpdate:n})=>{let[d,u]=we(o.metadata?.data?.theme||"dark"),[f,P]=we(o.metadata?.data?.autoSave??!0),[v,C]=we(o.metadata?.data?.notifications??!0),[z,X]=we(o.metadata?.data?.defaultView||"logs"),[R,m]=we(o.metadata?.data?.instrumentation?.enabled??!0),N=ye(()=>{let G={...o,metadata:{...o.metadata,createdAt:o.metadata?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),data:{theme:d,autoSave:f,notifications:v,defaultView:z,instrumentation:{...o.metadata?.data?.instrumentation,enabled:R}}}};n(G)},[o,d,f,v,z,R,n]);return je(()=>{N()},[d,f,v,z,R,N]),H("div",{className:"editor-section",children:[x("h4",{children:"Profile Settings"}),H("div",{className:"profile-settings-inputs",children:[H("div",{children:[x("label",{children:"Theme:"}),H("select",{value:d,onChange:G=>u(G.target.value),children:[x("option",{value:"dark",children:"Dark"}),x("option",{value:"light",children:"Light"}),x("option",{value:"auto",children:"Auto"})]})]}),H("div",{children:[x("label",{children:"Auto Save:"}),x("input",{type:"checkbox",checked:f,onChange:G=>P(G.target.checked)})]}),H("div",{children:[x("label",{children:"Notifications:"}),x("input",{type:"checkbox",checked:v,onChange:G=>C(G.target.checked)})]}),H("div",{children:[x("label",{children:"Default View:"}),H("select",{value:z,onChange:G=>X(G.target.value),children:[x("option",{value:"logs",children:"Logs"}),x("option",{value:"monitoring",children:"Monitoring"})]})]})]})]})},St=Bt;import{jsx as We,jsxs as Ke}from"react/jsx-runtime";var _t=({isOpen:o,imageUrl:n,overlay:d,json:u,onClose:f})=>o?Ke("div",{className:"screenshot-modal-backdrop",onClick:v=>{v.target===v.currentTarget&&f()},children:[Ke("div",{className:"screenshot-modal",children:[Ke("div",{className:"screenshot-modal-header",children:[We("h3",{children:"Screenshot View"}),We("button",{className:"close-btn",onClick:f,children:"\xD7"})]}),Ke("div",{className:"screenshot-modal-content",children:[n&&Ke("div",{className:"screenshot-container",children:[We("img",{src:n,alt:"Screenshot",className:"screenshot-image",style:{maxWidth:"100%",maxHeight:"70vh",objectFit:"contain"}}),d&&We("div",{className:"screenshot-overlay",children:We("pre",{children:JSON.stringify(d,null,2)})})]}),u&&Ke("div",{className:"screenshot-json",children:[We("h4",{children:"Associated Data:"}),We("pre",{children:JSON.stringify(u,null,2)})]})]})]}),We("style",{jsx:!0,children:`
        .screenshot-modal-backdrop {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
        }
        
        .screenshot-modal {
          background: white;
          border-radius: 8px;
          max-width: 90vw;
          max-height: 90vh;
          overflow: auto;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .screenshot-modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem;
          border-bottom: 1px solid #e0e0e0;
        }
        
        .screenshot-modal-header h3 {
          margin: 0;
          color: #333;
        }
        
        .close-btn {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: #666;
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .close-btn:hover {
          color: #000;
        }
        
        .screenshot-modal-content {
          padding: 1rem;
        }
        
        .screenshot-container {
          text-align: center;
          margin-bottom: 1rem;
        }
        
        .screenshot-image {
          border: 1px solid #ddd;
          border-radius: 4px;
        }
        
        .screenshot-overlay {
          margin-top: 1rem;
          background: #f5f5f5;
          padding: 1rem;
          border-radius: 4px;
          text-align: left;
        }
        
        .screenshot-json {
          margin-top: 1rem;
          background: #f8f9fa;
          padding: 1rem;
          border-radius: 4px;
        }
        
        .screenshot-json h4 {
          margin: 0 0 0.5rem 0;
          color: #333;
        }
        
        .screenshot-json pre {
          margin: 0;
          background: white;
          padding: 0.5rem;
          border: 1px solid #ddd;
          border-radius: 4px;
          overflow: auto;
          max-height: 300px;
        }
      `})]}):null,kt=_t;import{useState as He,useEffect as Nt}from"react";import{Fragment as rt,jsx as g,jsxs as S}from"react/jsx-runtime";var Gt=({isOpen:o,onClose:n})=>{let[d,u]=He([{id:"allog-server",name:"Allog Intermediary Server",type:"server",saveLogsDir:"./logs/allog-server",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"formwise-app",name:"FormWise Application",type:"client",saveLogsDir:"./logs/formwise",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"lib-interactive",name:"Interactive Library",type:"library",saveLogsDir:"./logs/lib/interactive",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"features-formhub",name:"FormHub Feature",type:"feature",saveLogsDir:"./logs/features/formhub",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()},{id:"features-clausesight",name:"ClauseSight Feature",type:"feature",saveLogsDir:"./logs/features/clausesight",lastSeen:new Date().toISOString(),status:"active",logCount:0,lastLogTime:new Date().toISOString()}]),[f,P]=He(null),[v,C]=He(!0),[z,X]=He(5e3),[R,m]=He("recipients"),[N,G]=He(null),[K,ae]=He(null),[re,ce]=He(null),[Ne,J]=He(!1),[b,i]=He(null);Nt(()=>{if(o&&v){let h=setInterval(()=>{u(Y=>Y.map(ee=>({...ee,logCount:Math.floor(Math.random()*1e3)+ee.logCount,lastLogTime:new Date().toISOString()})))},z);return()=>clearInterval(h)}},[o,v,z]),Nt(()=>{o&&a()},[o,R]);let a=async()=>{try{let h=[];(R==="database"||R==="maintenance")&&h.push(fetch("/api/database/config").then(ee=>ee.ok?ee.json():null),fetch("/api/database/stats").then(ee=>ee.ok?ee.json():null)),(R==="archives"||R==="maintenance")&&h.push(fetch("/api/archives").then(ee=>ee.ok?ee.json():null));let Y=await Promise.all(h);R==="database"||R==="maintenance"?(G(Y[0]),ae(Y[1]),(R==="archives"||R==="maintenance")&&ce(Y[2])):R==="archives"&&ce(Y[0])}catch(h){console.error("Failed to load data management info:",h),T("Failed to load data management information","error")}},T=(h,Y)=>{i({message:h,type:Y}),setTimeout(()=>i(null),5e3)},Q=async()=>{try{J(!0);let h=await fetch("/api/archives/rotate",{method:"POST"}),Y=await h.json();h.ok?(T("Log rotation completed successfully","success"),await a()):T(Y.error||"Failed to trigger log rotation","error")}catch{T("Failed to trigger log rotation","error")}finally{J(!1)}},M=async h=>{try{let Y=await fetch(`/api/archives/${h}`);if(Y.ok){let ee=await Y.blob(),Ie=window.URL.createObjectURL(ee),be=document.createElement("a");be.href=Ie,be.download=h,document.body.appendChild(be),be.click(),document.body.removeChild(be),window.URL.revokeObjectURL(Ie),T(`Archive ${h} downloaded successfully`,"success")}else T("Failed to download archive","error")}catch{T("Failed to download archive","error")}},ge=async(h,Y="json")=>{try{J(!0);let ee="";switch(h){case"logs":ee=`/api/export/logs?format=${Y}`;break;case"monitoring":ee=`/api/export/monitoring?format=${Y}`;break;case"backup":ee=`/api/export/backup?format=${Y}`;break}let Ie=await fetch(ee);if(Ie.ok){let be=await Ie.blob(),ve=window.URL.createObjectURL(be),Z=document.createElement("a");Z.href=ve,Z.download=`allog-${h}-export-${new Date().toISOString().slice(0,19).replace(/[-:]/g,"")}.${Y}`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),window.URL.revokeObjectURL(ve),T(`${h} data exported successfully`,"success")}else T(`Failed to export ${h} data`,"error")}catch{T(`Failed to export ${h} data`,"error")}finally{J(!1)}},$=h=>{switch(h){case"active":return"\u{1F7E2}";case"inactive":return"\u26AA";case"error":return"\u{1F534}";default:return"\u2753"}},pe=h=>{switch(h){case"server":return"\u{1F5A5}\uFE0F";case"client":return"\u{1F4F1}";case"feature":return"\u2728";case"library":return"\u{1F4DA}";default:return"\u2753"}},se=async h=>{if(h.saveLogsDir)try{if("showDirectoryPicker"in window){let Y=await window.showDirectoryPicker();console.log(`Opened directory for ${h.name}:`,Y)}else alert(`Save logs directory: ${h.saveLogsDir}`)}catch(Y){console.error("Failed to open directory:",Y),alert(`Save logs directory: ${h.saveLogsDir}`)}};return o?g("div",{className:"settings-overlay",onClick:n,children:S("div",{className:"settings-modal",onClick:h=>h.stopPropagation(),children:[S("div",{className:"settings-header",children:[g("h2",{children:"\u2699\uFE0F Allog Settings"}),g("button",{className:"close-btn",onClick:n,children:"\xD7"})]}),b&&S("div",{className:`settings-notification ${b.type}`,children:[g("span",{children:b.message}),g("button",{onClick:()=>i(null),children:"\xD7"})]}),S("div",{className:"settings-tabs",children:[g("button",{className:`tab-btn ${R==="recipients"?"active":""}`,onClick:()=>m("recipients"),children:"\u{1F4CA} Recipients"}),g("button",{className:`tab-btn ${R==="database"?"active":""}`,onClick:()=>m("database"),children:"\u{1F5C4}\uFE0F Database"}),g("button",{className:`tab-btn ${R==="archives"?"active":""}`,onClick:()=>m("archives"),children:"\u{1F4C1} Archives"}),g("button",{className:`tab-btn ${R==="maintenance"?"active":""}`,onClick:()=>m("maintenance"),children:"\u{1F527} Maintenance"})]}),S("div",{className:"settings-content",children:[R==="recipients"&&g(rt,{children:S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F4CA} Recipients & Save Logs Directories"}),g("p",{children:"View and manage save logs directories for each recipient sending data to Allog."}),g("div",{className:"recipients-grid",children:d.map(h=>S("div",{className:`recipient-card ${f?.id===h.id?"selected":""}`,onClick:()=>P(h),children:[S("div",{className:"recipient-header",children:[g("span",{className:"type-icon",children:pe(h.type)}),g("span",{className:"status-icon",children:$(h.status)}),g("h4",{children:h.name})]}),S("div",{className:"recipient-details",children:[S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Type:"}),g("span",{className:"value",children:h.type})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Status:"}),g("span",{className:"value",children:h.status})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Log Count:"}),g("span",{className:"value",children:h.logCount.toLocaleString()})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Last Seen:"}),g("span",{className:"value",children:new Date(h.lastSeen||"").toLocaleString()})]}),h.lastLogTime&&S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Last Log:"}),g("span",{className:"value",children:new Date(h.lastLogTime).toLocaleString()})]})]}),h.saveLogsDir&&S("div",{className:"save-logs-section",children:[S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Save Logs Dir:"}),g("span",{className:"value path",children:h.saveLogsDir})]}),g("button",{className:"open-dir-btn",onClick:Y=>{Y.stopPropagation(),se(h)},children:"\u{1F4C1} Open Directory"})]})]},h.id))})]})}),R==="database"&&S(rt,{children:[S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F5C4}\uFE0F Database Configuration"}),N?g("div",{className:"database-info",children:S("div",{className:"info-grid",children:[S("div",{className:"info-item",children:[g("span",{className:"label",children:"Backend Type:"}),S("span",{className:`value db-type-${N.type}`,children:[N.type.toUpperCase(),N.connected?" \u{1F7E2}":" \u{1F534}"]})]}),S("div",{className:"info-item",children:[g("span",{className:"label",children:"Status:"}),g("span",{className:"value",children:N.connected?"Connected":"Disconnected"})]}),S("div",{className:"info-item",children:[g("span",{className:"label",children:"Indexed Queries:"}),g("span",{className:"value",children:N.capabilities.indexedQueries?"\u2705":"\u274C"})]}),S("div",{className:"info-item",children:[g("span",{className:"label",children:"Transactions:"}),g("span",{className:"value",children:N.capabilities.transactions?"\u2705":"\u274C"})]}),S("div",{className:"info-item",children:[g("span",{className:"label",children:"Advanced Filtering:"}),g("span",{className:"value",children:N.capabilities.advancedFiltering?"\u2705":"\u274C"})]})]})}):g("div",{className:"loading",children:"Loading database configuration..."})]}),K&&S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F4CA} Database Statistics"}),S("div",{className:"stats-grid",children:[S("div",{className:"stat-card",children:[g("div",{className:"stat-value",children:K.logs.toLocaleString()}),g("div",{className:"stat-label",children:"Total Logs"})]}),S("div",{className:"stat-card",children:[g("div",{className:"stat-value",children:K.monitoring.toLocaleString()}),g("div",{className:"stat-label",children:"Monitoring Entries"})]}),S("div",{className:"stat-card",children:[g("div",{className:"stat-value",children:K.sources.toLocaleString()}),g("div",{className:"stat-label",children:"Data Sources"})]}),S("div",{className:"stat-card",children:[g("div",{className:"stat-value",children:K.memoryIndexes.logIndexSize.toLocaleString()}),g("div",{className:"stat-label",children:"Log Index Size"})]})]})]})]}),R==="archives"&&S(rt,{children:[S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F4C1} Archive Management"}),S("div",{className:"archive-controls",children:[g("button",{className:"action-btn primary",onClick:Q,disabled:Ne,children:Ne?"\u23F3 Rotating...":"\u{1F504} Trigger Log Rotation"}),g("p",{className:"help-text",children:"Manually trigger log rotation to archive current logs and start fresh."})]})]}),re&&S("div",{className:"settings-section",children:[S("h3",{children:["\u{1F4E6} Archive Files (",re.totalArchives,")"]}),S("div",{className:"archive-summary",children:[S("div",{className:"summary-item",children:[g("span",{className:"label",children:"Archive Directory:"}),g("span",{className:"value",children:re.archiveDirectory})]}),S("div",{className:"summary-item",children:[g("span",{className:"label",children:"Total Size:"}),S("span",{className:"value",children:[(re.totalSize/1024/1024).toFixed(2)," MB"]})]})]}),re.archives.length>0?g("div",{className:"archives-list",children:re.archives.map(h=>S("div",{className:"archive-item",children:[S("div",{className:"archive-info",children:[g("div",{className:"archive-name",children:h.filename}),S("div",{className:"archive-details",children:[g("span",{children:h.sizeFormatted}),g("span",{children:new Date(h.created).toLocaleString()})]})]}),g("div",{className:"archive-actions",children:g("button",{className:"action-btn secondary",onClick:()=>M(h.filename),children:"\u{1F4E5} Download"})})]},h.filename))}):S("div",{className:"empty-state",children:[g("p",{children:"No archive files available yet."}),g("p",{children:"Archives will appear here after log rotation occurs."})]})]})]}),R==="maintenance"&&S(rt,{children:[S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F527} Data Export & Backup"}),S("div",{className:"export-controls",children:[S("div",{className:"export-group",children:[g("h4",{children:"Export Logs"}),S("div",{className:"export-buttons",children:[g("button",{className:"action-btn secondary",onClick:()=>ge("logs","json"),disabled:Ne,children:"JSON"}),g("button",{className:"action-btn secondary",onClick:()=>ge("logs","csv"),disabled:Ne,children:"CSV"})]})]}),S("div",{className:"export-group",children:[g("h4",{children:"Export Monitoring Data"}),S("div",{className:"export-buttons",children:[g("button",{className:"action-btn secondary",onClick:()=>ge("monitoring","json"),disabled:Ne,children:"JSON"}),g("button",{className:"action-btn secondary",onClick:()=>ge("monitoring","csv"),disabled:Ne,children:"CSV"})]})]}),S("div",{className:"export-group",children:[g("h4",{children:"Full System Backup"}),g("div",{className:"export-buttons",children:g("button",{className:"action-btn primary",onClick:()=>ge("backup","json"),disabled:Ne,children:"\u{1F4E6} Complete Backup"})}),g("p",{className:"help-text",children:"Includes all logs, monitoring data, sources, and configuration."})]})]})]}),(K||re)&&S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F4CA} System Overview"}),S("div",{className:"overview-grid",children:[K&&S("div",{className:"overview-card",children:[g("h4",{children:"Database"}),S("div",{className:"overview-stats",children:[S("div",{children:[K.logs.toLocaleString()," logs"]}),S("div",{children:[K.monitoring.toLocaleString()," monitoring entries"]}),S("div",{children:[K.sources.toLocaleString()," sources"]})]})]}),re&&S("div",{className:"overview-card",children:[g("h4",{children:"Archives"}),S("div",{className:"overview-stats",children:[S("div",{children:[re.totalArchives," archive files"]}),S("div",{children:[(re.totalSize/1024/1024).toFixed(2)," MB total"]})]})]})]})]})]}),S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F504} Auto-Refresh Settings"}),g("div",{className:"setting-row",children:S("label",{children:[g("input",{type:"checkbox",checked:v,onChange:h=>C(h.target.checked)}),"Enable auto-refresh"]})}),g("div",{className:"setting-row",children:S("label",{children:["Refresh interval:",S("select",{value:z,onChange:h=>X(Number(h.target.value)),disabled:!v,children:[g("option",{value:1e3,children:"1 second"}),g("option",{value:2e3,children:"2 seconds"}),g("option",{value:5e3,children:"5 seconds"}),g("option",{value:1e4,children:"10 seconds"}),g("option",{value:3e4,children:"30 seconds"})]})]})})]}),S("div",{className:"settings-section",children:[g("h3",{children:"\u{1F4CB} Server Information"}),S("div",{className:"setting-row",children:[g("span",{className:"label",children:"Intermediary Server:"}),g("span",{className:"value",children:"http://localhost:3002"})]}),S("div",{className:"setting-row",children:[g("span",{className:"label",children:"Viewer Port:"}),g("span",{className:"value",children:"3001"})]}),S("div",{className:"setting-row",children:[g("span",{className:"label",children:"FormWise Port:"}),g("span",{className:"value",children:"3003"})]})]}),R==="recipients"&&f&&S("div",{className:"settings-section",children:[S("h3",{children:["\u{1F50D} ",f.name," Details"]}),S("div",{className:"detail-view",children:[S("div",{className:"detail-row",children:[g("span",{className:"label",children:"ID:"}),g("span",{className:"value",children:f.id})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Type:"}),g("span",{className:"value",children:f.type})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Status:"}),g("span",{className:"value",children:f.status})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Total Logs:"}),g("span",{className:"value",children:f.logCount.toLocaleString()})]}),f.saveLogsDir&&S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Save Logs Directory:"}),g("span",{className:"value path",children:f.saveLogsDir})]}),S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Last Seen:"}),g("span",{className:"value",children:new Date(f.lastSeen||"").toLocaleString()})]}),f.lastLogTime&&S("div",{className:"detail-row",children:[g("span",{className:"label",children:"Last Log Time:"}),g("span",{className:"value",children:new Date(f.lastLogTime).toLocaleString()})]})]})]})]}),g("div",{className:"settings-footer",children:g("button",{className:"save-btn",onClick:n,children:"Close"})})]})}):null},It=Gt;var mt=class{constructor(n){this.logs=[];this.maxLogs=fe.maxInternalLogs;this.enableConsole=fe.enableConsoleLogging;this.logLevel=fe.defaultInternalLogLevel;this.levelOrder={debug:0,info:1,warn:2,error:3};n&&(this.enableConsole=n.enableConsole??fe.enableConsoleLogging,this.logLevel=n.logLevel??fe.defaultInternalLogLevel,this.maxLogs=n.maxLogs??fe.maxInternalLogs)}shouldLog(n){return this.levelOrder[n]>=this.levelOrder[this.logLevel]}addLog(n,d,u,f){if(!this.shouldLog(n))return;let P={timestamp:new Date,level:n,component:d,message:u,data:f};if(this.logs.push(P),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.enableConsole){let v=`[${d}] ${u}`;switch(n){case"debug":console.debug(v,f||"");break;case"info":console.log(v,f||"");break;case"warn":console.warn(v,f||"");break;case"error":console.error(v,f||"");break}}}debug(n,d,u){this.addLog("debug",n,d,u)}info(n,d,u){this.addLog("info",n,d,u)}warn(n,d,u){this.addLog("warn",n,d,u)}error(n,d,u){this.addLog("error",n,d,u)}getLogs(){return[...this.logs]}getLogsForComponent(n){return this.logs.filter(d=>d.component===n)}getLogsForLevel(n){return this.logs.filter(d=>d.level===n)}clearLogs(){this.logs=[]}configure(n){n.enableConsole!==void 0&&(this.enableConsole=n.enableConsole),n.logLevel!==void 0&&(this.logLevel=n.logLevel),n.maxLogs!==void 0&&(this.maxLogs=n.maxLogs)}},Ye=new mt,le={debug:(o,n,d)=>{try{return Ye.debug(o,n,d)}catch{console.debug(`[${o}] ${n}`,d||"")}},info:(o,n,d)=>{try{return Ye.info(o,n,d)}catch{console.log(`[${o}] ${n}`,d||"")}},warn:(o,n,d)=>{try{return Ye.warn(o,n,d)}catch{console.warn(`[${o}] ${n}`,d||"")}},error:(o,n,d)=>{try{return Ye.error(o,n,d)}catch{console.error(`[${o}] ${n}`,d||"")}},getLogs:()=>{try{return Ye.getLogs()}catch{return[]}},getLogsForComponent:o=>{try{return Ye.getLogsForComponent(o)}catch{return[]}},clearLogs:()=>{try{return Ye.clearLogs()}catch{}},configure:o=>{try{return Ye.configure(o)}catch{}}};import{jsx as D,jsxs as ie}from"react/jsx-runtime";function Xt(){let[o,n]=Pe("logs"),[d,u]=Pe(!1),f=Ct(null),P=Le(t=>{le.info("App","Highlight created from context menu",t)},[]),{contextMenu:v,showContextMenu:C,hideContextMenu:z,createHighlight:X}=nt({onCreateHighlight:P}),{getHighlightStyles:R,isElementHighlighted:m}=it(),[N,G]=Pe([]),[K,ae]=Pe({totalLogs:0,bufferSize:0,enabledModules:0,totalModules:0,logLevels:{info:0,warn:0,error:0,debug:0},lastUpdate:new Date().toISOString()}),[re,ce]=Pe(fe.getInitialConnectionStatus()),[Ne,J]=Pe(fe.getInitialConnectionStatus()),[b,i]=Pe(fe.getInitialMonitoringStats()),[a,T]=Pe(fe.autoRefreshEnabled),[Q,M]=Pe(fe.defaultRefreshInterval),[ge,$]=Pe(!1),[pe,se]=Pe(new Set),[h,Y]=Pe(null),[ee,Ie]=Pe({open:!1}),[be,ve]=Pe({message:"",type:"info",visible:!1}),[Z,c]=Pe({level:"",scriptId:"",search:"",sourceId:"",startDate:"",endDate:""}),oe=Le(()=>o==="logs"?{view:"logs",logs:N,stats:K,filters:Z,autoRefresh:a,refreshInterval:Q}:{view:"monitoring"},[o,N,K,Z,a,Q]),Ae=Le((t,r="info")=>{ve({message:t,type:r,visible:!0}),setTimeout(()=>ve(B=>({...B,visible:!1})),3e3)},[]),xe=Le(t=>{if(t.recursive===!0)return!0;if(t.recursive===!1)return!1;let r=(t.scriptId||t.sourceId||"").toLowerCase(),B=(t.message||"").toLowerCase();return r.includes("viewer")||r.includes("allog")||B.includes("viewer")||B.includes("webpack")},[]);ut(()=>{let t=process?.env?.WS_TARGET,r=process?.env?.API_TARGET,B;if(t&&typeof t=="string"&&t.length>0)B=t;else if(r&&typeof r=="string"&&r.length>0)try{let A=new URL(r),ne=A.protocol==="https:"?"wss":"ws",W=A.port?`:${A.port}`:"";B=`${ne}://${A.hostname}${W}`}catch{let A=window.location.protocol==="https:"?"wss":"ws",ne=window.location.hostname,W=window.location.port,Oe=W===fe.viewerPort.toString()?fe.serverPort.toString():W||fe.serverPort.toString();B=`${A}://${ne}:${Oe}`}else{let A=window.location.protocol==="https:"?"wss":"ws",ne=window.location.hostname,W=window.location.port,Oe=W===fe.viewerPort.toString()?fe.serverPort.toString():W||fe.serverPort.toString();B=`${A}://${ne}:${Oe}`}let j=null;try{j=new WebSocket(B),j.onmessage=A=>{try{let ne=JSON.parse(A.data);if(ne.type==="new_log"){let W=ne.data,Oe={id:W.id,scriptId:W.scriptId||W.sourceId||"unknown",message:W.message,time:W.time||W.timestamp||W.serverReceivedAt||new Date().toISOString(),level:W.level,data:W.data,stack:W.stack};xe({...Oe,recursive:W.recursive})||G($e=>$e.some(Fe=>Fe.id===Oe.id)?$e:[Oe,...$e])}ne.type==="logs_cleared"&&(G([]),Y(null)),ne.type,ne.type==="monitoring_update"&&le.info("App","Received monitoring update",ne.data)}catch{}}}catch{}return()=>{try{j&&j.close()}catch(A){console.warn("[App] Failed to close socket:",A)}}},[xe]);let Me=Le(async()=>{try{let t=await fetch("/api/logs?includeRecursive=false");if(t.ok){let r=await t.json(),B=(r.logs||[]).map(j=>({id:j.id,scriptId:j.scriptId||j.sourceId||"unknown",message:j.message,time:j.time||j.timestamp||j.serverReceivedAt||new Date().toISOString(),level:j.level,data:j.data,stack:j.stack}));G(B.filter((j,A)=>!xe({...j,recursive:(r.logs||[])[A]?.recursive}))),Y(j=>j&&B.some(A=>A.id===j.id)?j:null)}}catch(t){le.error("App","Failed to fetch logs",t)}},[]),ze=Le(async()=>{try{let t=await fetch("/api/status");if(t.ok){let r=await t.json();ae(r),ce(B=>({...B,isConnected:!0,error:void 0}))}}catch(t){le.error("App","Failed to fetch stats",t),ce(r=>({...r,isConnected:!1,error:"Connection failed",retryCount:r.retryCount+1}))}},[]),Ee=Le(async()=>{try{let t=!1;try{t=(await fetch("/api/logs",{method:"DELETE"})).ok}catch(r){console.warn("[App] DELETE /api/logs failed, trying fallback:",r)}t||(t=(await fetch("/api/logs/clear",{method:"POST"})).ok),t&&(G([]),await ze())}catch(t){le.error("App","Failed to clear logs",t)}},[ze]);ut(()=>{if(!a)return;let t=setInterval(()=>{o==="logs"&&(Me(),ze())},Q);return()=>clearInterval(t)},[a,Q,Me,ze,o]),ut(()=>{Me(),ze()},[Me,ze]);let Ue=N.filter(t=>!(Z.scriptId&&!t.scriptId.includes(Z.scriptId)||Z.level&&t.level!==Z.level||Z.search&&!t.message.toLowerCase().includes(Z.search.toLowerCase()))),Qe=Array.from(new Set(N.map(t=>t.scriptId))).sort(),_e=t=>{let r=new Set(pe);r.has(t)?r.delete(t):r.add(t),se(r)},et=t=>{Y(t)},l=Le(async()=>{try{if("showDirectoryPicker"in window){let t=await window.showDirectoryPicker(),r=new Date().toISOString().replace(/[:.]/g,"-"),B=`logs_${r}.json`,j={timestamp:r,totalLogs:N.length,logs:N.map(W=>({id:W.id,scriptId:W.scriptId,level:W.level,time:W.time,message:W.message,data:W.data,stack:W.stack}))},ne=await(await t.getFileHandle(B,{create:!0})).createWritable();await ne.write(JSON.stringify(j,null,2)),await ne.close(),le.info("App",`Logs saved to: ${B}`)}}catch(t){console.warn("Could not save logs to directory:",t)}},[N]),s=Le(()=>{if(!h)return;let t={id:h.id,scriptId:h.scriptId,level:h.level,time:h.time,message:h.message,data:h.data,stack:h.stack};try{navigator.clipboard.writeText(JSON.stringify(t,null,2))}catch{}},[h]),O=t=>{if(t===null)return"null";if(t===void 0)return"undefined";if(Array.isArray(t))return"array";let r=typeof t;return r==="object"?"object":r==="string"?"string":r==="number"?"number":r==="boolean"?"boolean":"unknown"},k=t=>{switch(O(t)){case"object":case"array":try{return JSON.stringify(t,null,2)}catch{return String(t)}case"string":case"number":case"boolean":case"null":case"undefined":return String(t);default:try{return JSON.stringify(t)}catch{return String(t)}}},F=Ct(new Map),_=(t,r)=>{let B=`log-${r.id}`,j=Date.now(),A=F.current.get(B);if(A&&j-A.lastClick<300){A.timeout&&clearTimeout(A.timeout),F.current.delete(B),r.debug("App","Double right-click detected - allowing native context menu");return}A?.timeout&&clearTimeout(A.timeout);let ne=setTimeout(()=>{F.current.delete(B)},300);F.current.set(B,{lastClick:j,timeout:ne}),t.preventDefault(),t.stopPropagation();let W={name:r.message.substring(0,50)+(r.message.length>50?"...":""),description:`Log Entry: ${r.message}

Script: ${r.scriptId}
Level: ${r.level}
Time: ${new Date(r.time).toLocaleString()}

${r.data?`Data: ${JSON.stringify(r.data,null,2)}`:""}

${r.stack?`Stack: ${r.stack}`:""}`,scriptId:r.scriptId,tags:[r.scriptId,r.level,"log"],data:{logId:r.id,scriptId:r.scriptId,level:r.level,time:r.time,message:r.message,data:r.data,stack:r.stack}};C(t.clientX,t.clientY,W,t.currentTarget)},ue=Le(t=>{try{le.info("App","Saving item",{name:t.name,type:t.type});let r=oe();(t.type==="view-preset"||t.type==="log-session"||t.type==="filter-preset")&&t.metadata&&(t.metadata.data={...t.metadata.data,...r,savedAt:new Date().toISOString()},t.metadata.updatedAt=new Date().toISOString()),le.info("App","Enhanced save item with current state",{name:t.name})}catch(r){le.error("App","Failed to enhance save item",r)}},[oe]),Ge=Le(t=>{try{switch(le.info("App","Loading item",{name:t.name,type:t.type}),t.type){case"filter-preset":{t.metadata?.data?.filters&&(c(t.metadata.data.filters),le.info("App","Applied filter preset",{name:t.name}));break}case"view-preset":{let r=t.metadata?.data;r&&(r.view&&n(r.view),r.filters&&c(r.filters),r.autoRefresh!==void 0&&T(r.autoRefresh),le.info("App","Applied view preset",{name:t.name}));break}case"log-session":{let r=t.metadata?.data;r&&(r.logs&&G(r.logs),r.filters&&c(r.filters),r.stats&&ae(r.stats),le.info("App","Applied log session",{name:t.name}));break}case"monitoring-session":{n("monitoring"),le.info("App","Switched to monitoring view for session",{name:t.name});break}case"highlight":{le.info("App","Highlight loaded",{name:t.name});break}case"comparison":{le.info("App","Comparison loaded",{name:t.name});break}case"profile":{le.info("App","Profile loaded",{name:t.name});break}default:{let r=t;r.metadata?.data&&le.info("App","Loading generic save node",r.metadata.data);break}}if(t.metadata?.importedState){let r=t.metadata.importedState;r.view&&n(r.view),r.filters&&c(r.filters),le.info("App","Applied imported state from",{name:t.name})}}catch(r){le.error("App","Failed to load item",r),alert(`Failed to load ${t.name}: ${r.message}`)}},[]),me=Le(t=>{le.info("App","Deleting item",{itemId:t})},[]),De=Le(async(t,r="json")=>{try{if(r==="server-export"){await e(t);return}let B={version:"1.0.0",exportedAt:new Date().toISOString(),exportedBy:"Allog Viewer",item:t,...t.type==="view-preset"&&{currentState:oe()}},j=JSON.stringify(B,null,2),A=new Blob([j],{type:"application/json"}),ne=URL.createObjectURL(A),W=document.createElement("a");W.href=ne;let Oe=new Date().toISOString().slice(0,19).replace(/:/g,"-"),$e=t.name.replace(/[^a-zA-Z0-9-_]/g,"-");W.download=`allog-${t.type}-${$e}-${Oe}.json`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(ne),le.info("Export",`Successfully exported: ${t.name}`)}catch(B){le.error("App","Failed to export item",B)}},[oe]),e=Le(async t=>{try{let r="",B=oe();switch(t.type){case"log-session":{r=`/api/export/logs?${new URLSearchParams({format:"json",...Z.level&&{level:Z.level},...Z.sourceId&&{sourceId:Z.sourceId},...Z.scriptId&&{scriptId:Z.scriptId},...Z.startDate&&{start:Z.startDate},...Z.endDate&&{end:Z.endDate}})}`;break}case"monitoring-session":{r=`/api/export/monitoring?${new URLSearchParams({format:"json"})}`;break}case"view-preset":case"filter-preset":case"profile":{await De(t,"json");return}default:{r="/api/export/backup";break}}window.open(r,"_blank"),le.info("App","Server export initiated",{type:t.type,url:r})}catch(r){le.error("App","Server export failed",r)}},[oe,Z,De]),p=Le(async(t,r="json")=>{try{if(t.length===0)return;let B=t.reduce((Re,Xe)=>(Re[Xe.type]||(Re[Xe.type]=[]),Re[Xe.type].push(Xe),Re),{}),j={metadata:{exportedAt:new Date().toISOString(),exportedBy:"allog-viewer",version:"1.0",totalItems:t.length,itemTypes:Object.keys(B)},items:B},ne=`allog-bulk-export-${new Date().toISOString().split("T")[0]}.json`,W=JSON.stringify(j,null,2),Oe=new Blob([W],{type:"application/json"}),$e=URL.createObjectURL(Oe),Fe=document.createElement("a");Fe.href=$e,Fe.download=ne,Fe.click(),URL.revokeObjectURL($e),le.info("App","Bulk export completed",{filename:ne,itemCount:t.length,types:Object.keys(B)})}catch(B){le.error("App","Bulk export failed",B)}},[]),y=Le(t=>{try{if(t instanceof File){let r=new FileReader;r.onload=B=>{try{let j=B.target?.result,A=JSON.parse(j);y(A)}catch(j){le.error("App","Failed to parse imported file",j),alert("Invalid JSON file format")}},r.readAsText(t);return}if(I(t)){Se(t);return}if(V(t)){U(t);return}q(t)}catch(r){le.error("App","Failed to import data",r),alert(`Import failed: ${r.message}`)}},[]),I=t=>t.metadata&&t.items&&typeof t.items=="object",V=t=>t.metadata&&(t.logs||t.monitoringData)&&t.metadata.version?.includes("backup"),q=Le(t=>{if(!t||typeof t!="object")throw new Error("Invalid import data format");if(!t.item||!t.version)throw new Error("Import file missing required fields (item, version)");let r=t.item;if(!r.id||!r.name||!r.type)throw new Error("Imported item missing required fields (id, name, type)");let B=`imported-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,j={...r,id:B,name:`${r.name} (Imported)`,metadata:{...r.metadata,importedAt:new Date().toISOString(),originalId:r.id,importedFrom:t.exportedBy||"Unknown",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};r.type==="view-preset"&&t.currentState&&(j.metadata.importedState=t.currentState);let A=localStorage.getItem("allog-save-system"),ne=A?JSON.parse(A):{items:[]};ne.items.push(j),localStorage.setItem("allog-save-system",JSON.stringify(ne)),window.location.reload(),le.info("App","Successfully imported",{name:j.name})},[]),Se=Le(t=>{let{metadata:r,items:B}=t,j=0,A=0,ne=localStorage.getItem("allog-save-system"),W=ne?JSON.parse(ne):{items:[]};Object.entries(B).forEach(([Oe,$e])=>{Array.isArray($e)&&$e.forEach(Fe=>{try{let Re=`imported-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Xe={...Fe,id:Re,name:`${Fe.name} (Bulk Import)`,metadata:{...Fe.metadata,importedAt:new Date().toISOString(),originalId:Fe.id,importedFrom:"Bulk Export",bulkImportId:r.exportedAt,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};W.items.push(Xe),j++}catch(Re){le.error("App","Failed to import bulk item",Re),A++}})}),localStorage.setItem("allog-save-system",JSON.stringify(W)),le.info("App","Bulk import completed",{imported:j,skipped:A,types:Object.keys(B)}),alert(`Bulk import completed: ${j} items imported, ${A} skipped`),window.location.reload()},[]),U=Le(async t=>{try{if(confirm("This appears to be a server backup. Import as server data (replaces server data) or convert to client items?")){let B=await fetch("/api/import/backup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(B.ok){let j=await B.json();alert(`Server import completed: ${JSON.stringify(j.results,null,2)}`),le.info("App","Server backup imported",j)}else throw new Error(`Server import failed: ${B.statusText}`)}else ke(t)}catch(r){le.error("App","Server backup import failed",r),alert(`Server backup import failed: ${r.message}`)}},[]),ke=Le(t=>{let r=localStorage.getItem("allog-save-system"),B=r?JSON.parse(r):{items:[]},j=0;if(t.monitoringData&&Array.isArray(t.monitoringData)){let A={id:`converted-monitoring-${Date.now()}`,name:`Monitoring Session (${new Date(t.metadata.backupCreatedAt).toLocaleDateString()})`,type:"monitoring-session",metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),convertedFromBackup:!0,originalBackupDate:t.metadata.backupCreatedAt,entryCount:t.monitoringData.length}};B.items.push(A),j++}if(t.logs&&Array.isArray(t.logs)&&t.logs.length>0){let A={id:`converted-logs-${Date.now()}`,name:`Log Session (${new Date(t.metadata.backupCreatedAt).toLocaleDateString()})`,type:"log-session",metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),convertedFromBackup:!0,originalBackupDate:t.metadata.backupCreatedAt,logCount:t.logs.length}};B.items.push(A),j++}localStorage.setItem("allog-save-system",JSON.stringify(B)),le.info("App","Server backup converted to client items",{convertedCount:j,originalBackup:t.metadata.backupCreatedAt}),alert(`Converted ${j} server backup items to client save items`),window.location.reload()},[]),Ce=()=>ie("div",{className:"app",children:[ie("div",{className:"filters",children:[ie("select",{value:Z.scriptId,onChange:t=>c(r=>({...r,scriptId:t.target.value})),children:[D("option",{value:"",children:"All Scripts"}),Qe.map(t=>D("option",{value:t,children:t},t))]}),ie("select",{value:Z.level,onChange:t=>c(r=>({...r,level:t.target.value})),children:[D("option",{value:"",children:"All Levels"}),fe.validLogLevels.map(t=>D("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),D("input",{type:"text",placeholder:"Search logs...",value:Z.search,onChange:t=>c(r=>({...r,search:t.target.value}))}),D("button",{onClick:Ee,className:"clear-btn",children:"Clear Logs"}),D("button",{onClick:l,className:"save-btn",children:"\u{1F4BE} Save Logs"})]}),ie("div",{className:"monitoring-content",children:[D("div",{className:"monitoring-main",children:D("div",{className:"log-list",children:Ue.length===0?D("div",{className:"no-logs",children:re.isConnected?N.length===0?ie("div",{className:"empty-state",children:[D("div",{className:"empty-state-icon",children:"\u{1F4CB}"}),D("div",{className:"empty-state-title",children:"No Logs Yet"}),ie("div",{className:"empty-state-description",children:["No log entries have been received from any source.",D("br",{}),"Start sending logs using the Allog client library or test client."]})]}):ie("div",{className:"empty-state",children:[D("div",{className:"empty-state-icon",children:"\u{1F50D}"}),D("div",{className:"empty-state-title",children:"No Matching Logs"}),ie("div",{className:"empty-state-description",children:["No logs match your current filters.",D("br",{}),"Try adjusting your search criteria or clearing filters."]})]}):ie("div",{className:"empty-state",children:[D("div",{className:"empty-state-icon",children:"\u{1F50C}"}),D("div",{className:"empty-state-title",children:"Not Connected"}),ie("div",{className:"empty-state-description",children:["Unable to connect to the Allog intermediary server.",D("br",{}),"Make sure the server is running on port ",fe.serverPort,"."]})]})}):Ue.map(t=>{let r=R("log",t.scriptId,void 0,void 0,t.message),B=h?.id===t.id;return ie("div",{className:`log-entry log-${t.level} ${B?"selected":""} ${r.className}`,style:r.style,...r.dataAttributes,children:[ie("div",{className:"log-header",onClick:()=>{_e(t.id)},onContextMenu:j=>_(j,t),children:[D("div",{className:"log-time",children:new Date(t.time).toLocaleTimeString()}),D("div",{className:`log-level ${t.level}`,children:t.level.toUpperCase()}),D("div",{className:"log-script",children:t.scriptId}),D("div",{className:"log-message",children:t.message}),D("div",{className:"log-toggle",children:pe.has(t.id)?"\u25BC":"\u25B6"})]}),pe.has(t.id)&&ie("div",{className:"log-details",children:[t.data&&ie("div",{className:"log-data",children:[D("strong",{children:"Data:"}),D("pre",{children:JSON.stringify(t.data,null,2)})]}),t.stack&&ie("div",{className:"log-stack",children:[D("strong",{children:"Stack:"}),D("pre",{children:t.stack})]})]})]},t.id)})})}),h&&ie("div",{className:"monitoring-detail",children:[ie("div",{className:"detail-header",children:[D("h3",{children:"Data Details"}),ie("div",{className:"detail-header-controls",children:[D("button",{className:"copy-btn",onClick:s,title:"Copy data to clipboard",children:"\u{1F4CB} Copy"}),D("button",{className:"close-btn",onClick:()=>Y(null),children:"\xD7"})]})]}),ie("div",{className:"detail-content",children:[ie("div",{className:"detail-section",children:[D("h4",{children:"Basic Information"}),ie("div",{className:"detail-item",children:[D("span",{className:"detail-label",children:"Script:"}),D("span",{className:"detail-value",children:h.scriptId})]}),ie("div",{className:"detail-item",children:[D("span",{className:"detail-label",children:"Level:"}),D("span",{className:"detail-value",children:h.level.toUpperCase()})]}),ie("div",{className:"detail-item",children:[D("span",{className:"detail-label",children:"Time:"}),D("span",{className:"detail-value",children:new Date(h.time).toLocaleString()})]}),ie("div",{className:"detail-item",children:[D("span",{className:"detail-label",children:"Message:"}),D("span",{className:"detail-value",children:h.message})]})]}),h.data!==void 0&&ie("div",{className:"detail-section",children:[D("h4",{children:"Data"}),ie("div",{className:"detail-item",children:[D("span",{className:"detail-label",children:"Current Value:"}),D("div",{className:"detail-value-container",children:D("span",{className:`detail-value detail-value-${O(h.data)}`,children:k(h.data)})})]})]}),h.stack&&ie("div",{className:"detail-section",children:[D("h4",{children:"Stack"}),D("pre",{className:"detail-stack",children:h.stack})]})]})]})]})]}),tt=()=>D("div",{className:"app",children:D(lt,{onStatsUpdate:i,onConnectionUpdate:J,saveSystemRef:f})}),Lt=()=>{let t=window.location.hostname,r=window.location.port,j=`http://${t}:3001`;return D("div",{className:"app",children:D(pt,{serverUrl:j,autoRefresh:a,refreshInterval:Q})})},Dt=()=>D(wt,{});return ie("div",{className:"app-container",children:[D(St,{ref:f,isOpen:ge,onToggle:()=>$(!ge),onSave:ue,onLoad:Ge,onDelete:me,onExport:De,onImport:y,currentData:oe(),currentView:o,onCreateHighlight:P}),D(at,{isVisible:v.isVisible,x:v.x,y:v.y,items:(()=>{let t=v.targetData?m("log",v.targetData.scriptId,void 0,void 0,v.targetData.data?.message):null,r=()=>{let A=process?.env?.API_TARGET;return A&&typeof A=="string"&&A.length>0?A:`${window.location.protocol}//${window.location.host}`},B=()=>{let A=v.targetData?.data?.data?.imageUrl||v.targetData?.data?.imageUrl;return!!(A&&typeof A=="string"&&A.trim().length>0)},j=[];return B()&&j.push({id:"view-screenshot",label:"View Screenshot",icon:"\u{1F5BC}\uFE0F",action:()=>{let A=v.targetData?.data?.data?.imageUrl||v.targetData?.data?.imageUrl,ne=v.targetData?.data?.data?.overlay||v.targetData?.data?.overlay;if(A){let W=A;if(W.startsWith("/uploads"))try{W=new URL(W,r()).toString()}catch(Oe){console.warn("[App] Failed to construct image URL:",Oe)}Ie({open:!0,imageUrl:W,overlay:ne})}}}),j.push({id:"inspect-log",label:"Inspect",icon:"\u{1F50E}",action:()=>{let A=v.targetData?.data?.logId;if(!A)return;let ne=N.find(W=>W.id===A);ne&&Y(ne)}},{id:"save-log-to-directory",label:"Save Log to Directory",icon:"\u{1F4BE}",action:async()=>{try{if("showDirectoryPicker"in window&&v.targetData?.data?.logId){let A=N.find(ne=>ne.id===v.targetData.data.logId);if(A){let ne=await window.showDirectoryPicker(),W=new Date().toISOString().replace(/[:.]/g,"-"),Oe=`log_${A.scriptId}_${W}.json`,$e={timestamp:W,log:{id:A.id,scriptId:A.scriptId,level:A.level,time:A.time,message:A.message,data:A.data,stack:A.stack}},Re=await(await ne.getFileHandle(Oe,{create:!0})).createWritable();await Re.write(JSON.stringify($e,null,2)),await Re.close(),A.info("App",`Log saved to: ${Oe}`)}}}catch(A){console.warn("Could not save log to directory:",A)}}},{id:"highlight",label:t?"Remove Highlight":"Highlight",icon:t?"\u274C":"\u{1F4A1}",action:()=>{v.targetData&&f.current&&(t?f.current.removeHighlightForElement({elementType:"log",scriptId:v.targetData.scriptId,logMessage:v.targetData.data?.message}):f.current.createHighlightFromData(v.targetData))}}),j})(),onClose:z}),ie("div",{className:`main-content ${ge?"with-save-system":""}`,children:[ie("div",{className:"header",children:[D("button",{className:"save-system-toggle-btn",onClick:()=>$(!ge),title:"Toggle Save System",children:"\u{1F4BE}"}),ie("div",{className:"header-controls",children:[ie("div",{className:"view-toggle",children:[D("button",{className:`view-btn ${o==="logs"?"active":""}`,onClick:()=>n("logs"),children:"\u{1F4CB} Logs"}),D("div",{className:"view-separator"}),D("button",{className:`view-btn ${o==="monitoring"?"active":""}`,onClick:()=>n("monitoring"),children:"\u{1F4CA} Monitoring"}),D("div",{className:"view-separator"}),D("button",{className:`view-btn ${o==="recursive"?"active":""}`,onClick:()=>n("recursive"),children:"\u{1F504} Recursive Logs"}),D("div",{className:"view-separator"}),D("button",{className:`view-btn ${o==="instrumentation"?"active":""}`,onClick:()=>n("instrumentation"),children:"\u{1F527} Instrumentation"})]}),ie("div",{className:"connection-status",children:[D("span",{className:`status-indicator ${o==="logs"?re.isConnected?"connected":"disconnected":o==="monitoring"?Ne.isConnected?"connected":"disconnected":"connected"}`,children:o==="logs"?re.isConnected?"\u25CF":"\u25CB":o==="monitoring"?Ne.isConnected?"\u25CF":"\u25CB":"\u25CF"}),D("span",{className:"status-text",children:o==="logs"?re.isConnected?"Connected":"Disconnected":o==="monitoring"?Ne.isConnected?"Connected":"Disconnected":"Connected"})]}),ie("div",{className:"auto-refresh-controls",children:[ie("label",{children:[D("input",{type:"checkbox",checked:a,onChange:t=>T(t.target.checked)}),"Auto-refresh"]}),D("select",{value:Q,onChange:t=>M(Number(t.target.value)),disabled:!a,children:fe.refreshOptions.map(t=>D("option",{value:t,children:t>=1e3?`${t/1e3}s`:`${t}ms`},t))})]}),D("div",{className:"settings-controls",children:D("button",{onClick:()=>u(t=>!t),className:"settings-btn",title:"Open settings and view save logs directories",children:"\u2699\uFE0F Settings"})})]})]}),be.visible&&ie("div",{className:`notification notification-${be.type}`,children:[D("span",{className:"notification-message",children:be.message}),D("button",{className:"notification-close",onClick:()=>ve(t=>({...t,visible:!1})),children:"\xD7"})]}),o==="logs"?Ce():o==="monitoring"?tt():o==="recursive"?Lt():Dt()]}),D(kt,{isOpen:ee.open,imageUrl:ee.imageUrl||"",overlay:ee.overlay,json:h?.data,onClose:()=>Ie({open:!1})}),D(It,{isOpen:d,onClose:()=>u(!1)})]})}var wo=Xt;export{wo as default};
